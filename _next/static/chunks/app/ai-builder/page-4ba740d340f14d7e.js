(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[327],{24265:(e,t,a)=>{Promise.resolve().then(a.bind(a,91117))},91117:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ed});var n=a(54568),l=a(7620),r=a(32545),s=a(78021),o=a(87606),i=a(93928),c=a(58950),d=a(78514),m=a(93492),u=a(61038),p=a(56479),h=a(30142),f=a(34118),g=a(47227),b=a(17129),x=a(63353),v=a(83908),y=a(64529),j=a(60066),N=a(19594),w=a(49369),C=a(62501),S=a(39690),A=a(8024),E=a(43755),k=a(70111),I=a(93204);function O(e){let t=e.match(/```formedible\s*\n([\s\S]*?)\n```/);return t&&t[1]?t[1].trim():null}function L(e,t,a){let n=[];return e.forEach((e,l)=>{if("assistant"===e.role&&e.content){let r=O(e.content);r&&n.push({id:t?"form_".concat(t,"_").concat(l):"form_".concat(Date.now(),"_").concat(l),code:r,timestamp:a||new Date})}}),n}function T(e){let t,{content:a}=e,l=/```(\w+)?\s*\n([\s\S]*?)\n```/g,r=[],s=0;for(;null!==(t=l.exec(a));){t.index>s&&r.push((0,n.jsx)("span",{className:"whitespace-pre-wrap break-words leading-relaxed",children:a.slice(s,t.index)},"text-".concat(s)));let e=t[1]||"text",l=t[2];r.push((0,n.jsx)("div",{className:"my-2",children:(0,n.jsx)(I.N,{code:l,language:e,showLineNumbers:!1,showCopyButton:!0,className:"text-xs",darkMode:!0,scrollable:!1})},"code-".concat(t.index))),s=t.index+t[0].length}return s<a.length&&r.push((0,n.jsx)("span",{className:"whitespace-pre-wrap break-words leading-relaxed",children:a.slice(s)},"text-".concat(s))),(0,n.jsx)("div",{className:"space-y-1",children:r.length>0?r:(0,n.jsx)("span",{className:"whitespace-pre-wrap break-words leading-relaxed",children:a})})}function F(e){let{onFormGenerated:t,onStreamingStateChange:a,onConversationUpdate:r,onNewConversation:s,messages:o,className:I,providerConfig:L}=e,[F,D]=(0,l.useState)(""),[P,_]=(0,l.useState)(o||[]),[z,R]=(0,l.useState)(!1),[M,Z]=(0,l.useState)(null),[q,K]=(0,l.useState)(!1),G=(0,l.useRef)(null),V=(0,l.useRef)(null),B=(0,l.useCallback)(()=>{let e=G.current;e&&(e.scrollTop=e.scrollHeight)},[]),$=(0,l.useCallback)(()=>{if(!G.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:a}=G.current;K(!(t-e-a<100)&&P.length>0)},[P.length]);(0,l.useEffect)(()=>{void 0!==o&&_(o)},[o]),(0,l.useEffect)(()=>{let e=G.current;if(e)return e.addEventListener("scroll",$),$(),()=>e.removeEventListener("scroll",$)},[$]);let U=e=>{let{provider:t,apiKey:a,model:n,endpoint:l}=e;switch(t){case"openai":return(0,d.r)({apiKey:a})(n||"gpt-5");case"anthropic":return(0,m.n)({apiKey:a})(n||"claude-sonnet-4");case"google":return(0,u.s)({apiKey:a})(n||"gemini-2.5-pro");case"mistral":return(0,p.T)({apiKey:a})(n||"mistral-large-2407");case"openrouter":return(0,h.ER)({apiKey:a}).chat(n||"openrouter/kimiplus-k2");case"openai-compatible":if(!l)throw Error("Endpoint required for OpenAI-compatible providers");return(0,f.jr)({name:"openai-compatible",baseURL:l,...a&&{apiKey:a}})(n||"gpt-4.1-mini");default:throw Error("Unsupported provider")}},J=async e=>{if(!L)return void Z(Error("Provider configuration required"));try{R(!0),Z(null),null==a||a(!0);let n={id:Date.now().toString(),role:"user",content:e},l=[...P,n];_(l);let s=U(L),o=new AbortController;V.current=o;let i=(0,c.gM)({model:s,system:"You are a helpful AI assistant for form creation. You can chat naturally with users about forms, answer questions, and help them design forms.\n\n**IMPORTANT: Only show formedible code blocks when the user specifically asks to create, build, generate, or show a form.**\n\nWhen creating forms, use formedible code blocks with complete JavaScript object literal syntax including Zod schemas:\n\n```formedible\n{\n  schema: z.object({\n    firstName: z.string().min(1, 'First name is required'),\n    email: z.string().email('Please enter a valid email address'),\n    age: z.number().min(18, 'Must be 18 or older').optional(),\n    newsletter: z.boolean().default(false)\n  }),\n  fields: [\n    {\n      name: 'firstName',\n      type: 'text',\n      label: 'First Name',\n      placeholder: 'Enter your first name'\n    },\n    {\n      name: 'email',\n      type: 'email', \n      label: 'Email Address',\n      placeholder: 'your@email.com'\n    },\n    {\n      name: 'age',\n      type: 'number',\n      label: 'Age',\n      placeholder: '18+'\n    },\n    {\n      name: 'newsletter',\n      type: 'checkbox',\n      label: 'Subscribe to newsletter'\n    }\n  ],\n  formOptions: {\n    defaultValues: {\n      firstName: '',\n      email: '',\n      newsletter: false\n    }\n  }\n}\n```\n\n**CRITICAL REQUIREMENTS:**\n- ALWAYS include complete Zod schema with proper validation\n- Use JavaScript object literals (unquoted keys, single quotes for strings) \n- Match schema field names EXACTLY with field names\n- Include proper Zod validations: .min(), .max(), .email(), .optional(), .default()\n- Available field types: text, email, password, tel, textarea, select, checkbox, switch, number, date, slider, file, rating, phone, colorPicker, location, duration, multiSelect, autocomplete, masked, object, array, radio\n\n**Zod Schema Examples:**\n- z.string().min(1, 'Required') - required text\n- z.string().email('Invalid email') - email validation  \n- z.number().min(18, 'Must be 18+') - number with min\n- z.boolean().default(false) - checkbox with default\n- z.string().optional() - optional field\n- z.enum(['option1', 'option2']) - select options\n- z.array(z.string()) - multiSelect\n\n**ARRAY FIELDS - Use arrayConfig with proper configuration:**\n\nSimple string arrays:\n```javascript\n{\n  name: 'contactMethods',\n  type: 'array',\n  label: 'Contact Email Addresses',\n  arrayConfig: {\n    itemType: 'email',\n    itemLabel: 'Email Address',\n    itemPlaceholder: 'contact@company.com',\n    minItems: 1,\n    maxItems: 5,\n    addButtonLabel: 'Add Email',\n    removeButtonLabel: 'Remove',\n    defaultValue: ''\n  }\n}\n```\n\nComplex object arrays:\n```javascript\n{\n  name: 'teamMembers',\n  type: 'array',\n  label: 'Team Members',\n  arrayConfig: {\n    itemType: 'object',\n    itemLabel: 'Team Member',\n    minItems: 1,\n    maxItems: 10,\n    sortable: true,\n    addButtonLabel: 'Add Team Member',\n    removeButtonLabel: 'Remove Member',\n    defaultValue: {\n      name: '',\n      email: '',\n      role: 'developer'\n    },\n    objectConfig: {\n      fields: [\n        {\n          name: 'name',\n          type: 'text',\n          label: 'Name',\n          placeholder: 'Enter name'\n        },\n        {\n          name: 'email',\n          type: 'text',\n          label: 'Email',\n          placeholder: 'Enter email'\n        },\n        {\n          name: 'role',\n          type: 'select',\n          label: 'Role',\n          options: [\n            { value: 'developer', label: 'Developer' },\n            { value: 'designer', label: 'Designer' }\n          ]\n        }\n      ]\n    }\n  }\n}\n```\n\n**STANDALONE OBJECT FIELDS - Use objectConfig with fields:**\n\n```javascript\n{\n  name: 'atmosphericConditions',\n  type: 'object',\n  label: 'Atmospheric Conditions',\n  description: 'Fundamental atmospheric parameters',\n  objectConfig: {\n    title: 'Atmospheric Parameters',\n    collapsible: true,\n    defaultExpanded: true,\n    columns: 2,\n    layout: 'grid',\n    fields: [\n      {\n        name: 'altitude',\n        type: 'number',\n        label: 'Altitude',\n        placeholder: 'Enter altitude in meters'\n      },\n      {\n        name: 'pressure',\n        type: 'number',\n        label: 'Pressure',\n        placeholder: 'Enter pressure in hPa'\n      },\n      {\n        name: 'temperature',\n        type: 'slider',\n        label: 'Temperature',\n        min: -50,\n        max: 50,\n        step: 1\n      }\n    ]\n  }\n}\n```\n\n**NESTED OBJECT FIELDS - Objects inside objects:**\n\n```javascript\n{\n  name: 'location',\n  type: 'object',\n  label: 'Location Details',\n  objectConfig: {\n    fields: [\n      {\n        name: 'coordinates',\n        type: 'object',\n        label: 'GPS Coordinates',\n        objectConfig: {\n          fields: [\n            {\n              name: 'latitude',\n              type: 'number',\n              label: 'Latitude',\n              placeholder: 'Enter latitude'\n            },\n            {\n              name: 'longitude',\n              type: 'number',\n              label: 'Longitude',\n              placeholder: 'Enter longitude'\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n```\n\n**Optional properties:**\n- pages: [...] for multi-page forms\n- progress: { showSteps: true, showPercentage: false }\n- submitLabel: 'Submit Form'\n- formOptions: { defaultValues: {...}, onSubmit: async (data) => {...} }\n\nChat naturally. Ask clarifying questions. Suggest improvements. Only output formedible blocks when specifically requested.",messages:[...P,n].map(e=>({role:e.role,content:e.content})),temperature:L.temperature||.7,maxOutputTokens:L.maxTokens||2e3,abortSignal:o.signal}),d={id:(Date.now()+1).toString(),role:"assistant",content:""};_(e=>[...e,d]);let m="";for await(let e of i.textStream){if(o.signal.aborted)break;m+=e,_(e=>e.map(e=>e.id===d.id?{...e,content:m}:e))}if(m&&t){let e=O(m);e&&t(e)}null==a||a(!1);let u=[...l,{...d,content:m}];null==r||r(u,!0)}catch(e){console.error("AI Generation Error:",e),Z(e instanceof Error?e:Error("Unknown error occurred"))}finally{R(!1),null==a||a(!1),V.current=null}},W=e=>{e.preventDefault(),F.trim()&&!z&&L&&(D(""),J(F))};return(0,n.jsxs)(x.Zp,{className:(0,i.cn)("flex flex-col h-full max-h-full border-2 border-accent/30 shadow-lg !py-0 !gap-0 overflow-hidden",I),children:[(0,n.jsx)(x.aR,{className:"px-3 pt-1 pb-0 bg-gradient-to-r from-accent/10 to-transparent",children:(0,n.jsxs)(x.ZB,{className:"flex items-center justify-between text-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"p-2 bg-accent/20 rounded-lg",children:(0,n.jsx)(v.A,{className:"h-5 w-5 text-accent-foreground"})}),(0,n.jsx)("span",{className:"text-foreground font-semibold",children:"AI Form Builder Chat"})]}),s&&(0,n.jsxs)(g.$,{variant:"outline",size:"sm",onClick:s,className:"h-8 w-8 p-0",children:[(0,n.jsx)(y.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"New conversation"})]})]})}),(0,n.jsxs)(x.Wu,{className:"flex flex-col flex-1 px-3 pt-0 pb-1 min-h-0 max-h-full relative overflow-hidden",children:[(0,n.jsxs)("div",{ref:G,className:"flex-1 overflow-y-auto space-y-3 mb-1 pr-2 min-h-0",children:[0===P.length&&(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[(0,n.jsx)(j.A,{className:"h-12 w-12 mb-4 opacity-50"}),(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Welcome to AI Form Builder"}),(0,n.jsx)("p",{className:"text-sm max-w-md",children:'Describe the form you want to create and I\'ll generate it for you. Try something like "Create a contact form with name, email, and message fields"'})]}),P.map(e=>(0,n.jsxs)("div",{className:(0,i.cn)("flex gap-3 max-w-4xl","user"===e.role?"ml-auto flex-row-reverse":"mr-auto"),children:[(0,n.jsx)("div",{className:(0,i.cn)("flex h-8 w-8 shrink-0 select-none items-center justify-center rounded-full border-2 shadow-md","user"===e.role?"bg-primary text-primary-foreground border-primary/30":"bg-muted text-foreground border-border"),children:"user"===e.role?(0,n.jsx)(N.A,{className:"h-4 w-4"}):(0,n.jsx)(j.A,{className:"h-4 w-4"})}),(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col gap-2 rounded-lg px-4 py-3 text-sm shadow-md border max-w-[85%]","user"===e.role?"bg-primary text-primary-foreground border-primary/30":"bg-background text-foreground border-border"),children:(0,n.jsx)(T,{content:e.content})})]},e.id)),z&&(0,n.jsxs)("div",{className:"flex gap-3 max-w-4xl mr-auto",children:[(0,n.jsx)("div",{className:"flex h-8 w-8 shrink-0 select-none items-center justify-center rounded-full border-2 shadow-md bg-muted text-foreground border-border",children:(0,n.jsx)(j.A,{className:"h-4 w-4"})}),(0,n.jsxs)("div",{className:"flex items-center gap-2 rounded-lg px-4 py-3 text-sm shadow-md border bg-background text-foreground border-border",children:[(0,n.jsx)(w.A,{className:"h-4 w-4 animate-spin text-primary"}),(0,n.jsx)("span",{children:"Generating response..."})]})]})]}),q&&(0,n.jsxs)(g.$,{onClick:B,className:"absolute bottom-20 right-4 rounded-full w-10 h-10 p-0 shadow-lg z-10",variant:"secondary",size:"sm",children:[(0,n.jsx)(C.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Scroll to bottom"})]}),M&&(0,n.jsxs)(k.Fc,{variant:"destructive",className:"mb-4",children:[(0,n.jsx)(S.A,{className:"h-4 w-4"}),(0,n.jsx)(k.TN,{children:"Failed to send message. Please check your configuration and try again."})]}),(0,n.jsxs)("form",{onSubmit:W,className:"flex gap-2",children:[(0,n.jsx)(b.T,{value:F,onChange:e=>D(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),W(e))},placeholder:"Describe the form you want to create... (Shift+Enter for new line)",disabled:z,className:"flex-1 min-h-[80px] resize-none",rows:3}),z?(0,n.jsxs)(g.$,{type:"button",variant:"outline",size:"icon",onClick:()=>{V.current&&(V.current.abort(),R(!1))},className:"shrink-0",children:[(0,n.jsx)(A.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Stop generation"})]}):(0,n.jsxs)(g.$,{type:"submit",disabled:!F.trim(),size:"icon",className:"shrink-0",children:[(0,n.jsx)(E.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Send message"})]})]})]})]})}function D(e){let{onFormGenerated:t,onStreamingStateChange:a,onConversationUpdate:l,onNewConversation:r,messages:s,className:o,providerConfig:c}=e;return(0,n.jsx)(F,{onFormGenerated:t,onStreamingStateChange:a,onConversationUpdate:l,onNewConversation:r,messages:s,providerConfig:c,className:(0,i.cn)("h-full",o)})}var P=a(80318);class _{static parse(e,t){if(!e||"string"!=typeof e)throw Error("Input code must be a non-empty string");try{(null==t?void 0:t.strictValidation)!==void 0&&(this.CONFIG.ENABLE_STRICT_VALIDATION=t.strictValidation);let a=this.sanitizeCode(e),n=this.parseObjectLiteral(a);return this.validateAndSanitize(n)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("FormedibleParser: Failed to parse form definition - ".concat(e))}}static isValidFieldType(e){return this.ALLOWED_FIELD_TYPES.includes(e)}static getSupportedFieldTypes(){return[...this.ALLOWED_FIELD_TYPES]}static sanitizeCode(e){let t=e.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*$/gm,"");return(t=(t=(t=(t=t.replace(/\b(eval|Function|setTimeout|setInterval|require|import)\s*\(/g,"")).replace(/=>\s*{[^}]*}/g,'""')).replace(/function\s*\([^)]*\)\s*{[^}]*}/g,'""')).replace(/new\s+Date\(\)\.toISOString\(\)\.split\('[^']*'\)\[0\]/g,'"2024-01-01"')).replace(/new\s+Date\(\)/g,'"2024-01-01T00:00:00Z"')}static parseObjectLiteral(e){try{return JSON.parse(e)}catch(a){let t=e.trim();try{return t=(t=(t=(t=this.replaceZodExpressions(t)).replace(/([{,]\s*)([a-zA-Z_$][a-zA-Z0-9_$]*)\s*:/g,'$1"$2":')).replace(/,(\s*[}\]])/g,"$1")).replace(/'/g,'"'),JSON.parse(t)}catch(a){throw console.error("Failed to parse after conversion:",{originalCode:e.substring(0,200),processedCode:t.substring(0,200),error:a instanceof Error?a.message:String(a)}),Error("Invalid syntax. Please use valid JSON format or JavaScript object literal syntax. Error: ".concat(a instanceof Error?a.message:String(a)))}}}static replaceZodExpressions(e){let t=e,a=!0;for(;a;){a=!1;let e=t.match(/z\.[a-zA-Z]+\(/);if(e){let n=e.index,l=n+e[0].length-1,r=1,s=l+1;for(;s<t.length&&r>0;)"("===t[s]?r++:")"===t[s]&&r--,s++;if(0===r){let e=s;for(;e<t.length;){let a=t.slice(e).match(/^\.[a-zA-Z]+\(/);if(a){let n=1,l=e+a[0].length-1+1;for(;l<t.length&&n>0;)"("===t[l]?n++:")"===t[l]&&n--,l++;if(0===n)e=l;else break}else break}t=t.slice(0,n)+'"'.concat(this.CONFIG.ZOD_PLACEHOLDER,'"')+t.slice(e),a=!0}else t=t.replace(/z\.[a-zA-Z]+/,'"'.concat(this.CONFIG.ZOD_PLACEHOLDER,'"')),a=!0}}return t.replace(/z\.enum\(\[[^\]]*\]\)/g,'"'.concat(this.CONFIG.ZOD_PLACEHOLDER,'"'))}static validateAndSanitize(e){if("object"!=typeof e||null===e)throw Error("Definition must be an object");let t={fields:[]};for(let[a,n]of Object.entries(e))if(this.ALLOWED_KEYS.includes(a))switch(a){case"schema":t.schema=n;break;case"fields":t.fields=this.validateFields(n);break;case"pages":Array.isArray(n)&&(t.pages=n);break;case"title":"string"==typeof n&&(t.title=n);break;case"description":"string"==typeof n&&(t.description=n);break;case"submitLabel":"string"==typeof n&&(t.submitLabel=n);break;case"nextLabel":"string"==typeof n&&(t.nextLabel=n);break;case"previousLabel":"string"==typeof n&&(t.previousLabel=n);break;case"formClassName":"string"==typeof n&&(t.formClassName=n);break;case"fieldClassName":"string"==typeof n&&(t.fieldClassName=n);break;case"progress":t.progress=n;break;case"formOptions":t.formOptions=n}return t}static validateFields(e){if(!Array.isArray(e))throw Error("Fields must be an array");return e.map((e,t)=>{if("object"!=typeof e||null===e)throw Error("Field at index ".concat(t," must be an object"));if(!e.name||!e.type)throw Error("Field at index ".concat(t," must have 'name' and 'type' properties"));if("string"!=typeof e.name||"string"!=typeof e.type)throw Error("Field at index ".concat(t," must have string 'name' and 'type' properties"));if(!this.ALLOWED_FIELD_TYPES.includes(e.type))throw Error("Field at index ".concat(t," has invalid type '").concat(e.type,"'"));let a={name:e.name,type:e.type};if(e.label&&"string"==typeof e.label&&(a.label=e.label),e.placeholder&&"string"==typeof e.placeholder&&(a.placeholder=e.placeholder),e.description&&"string"==typeof e.description&&(a.description=e.description),"boolean"==typeof e.required&&(a.required=e.required),void 0!==e.defaultValue&&(a.defaultValue=e.defaultValue),"number"==typeof e.min&&(a.min=e.min),"number"==typeof e.max&&(a.max=e.max),"number"==typeof e.step&&(a.step=e.step),"boolean"==typeof e.required&&(a.required=e.required),e.arrayConfig&&"object"==typeof e.arrayConfig&&(a.arrayConfig=e.arrayConfig),e.objectConfig&&"object"==typeof e.objectConfig){let t=e.objectConfig,n={fields:t.fields?this.validateFields(t.fields).map(e=>({name:e.name,type:e.type,label:e.label,placeholder:e.placeholder,description:e.description,options:e.options,min:e.min,max:e.max,step:e.step})):[]};t.title&&"string"==typeof t.title&&(n.title=t.title),t.description&&"string"==typeof t.description&&(n.description=t.description),"boolean"==typeof t.collapsible&&(n.collapsible=t.collapsible),"boolean"==typeof t.defaultExpanded&&(n.defaultExpanded=t.defaultExpanded),"boolean"==typeof t.showCard&&(n.showCard=t.showCard),t.layout&&["vertical","horizontal","grid"].includes(t.layout)&&(n.layout=t.layout),"number"==typeof t.columns&&(n.columns=t.columns),t.collapseLabel&&"string"==typeof t.collapseLabel&&(n.collapseLabel=t.collapseLabel),t.expandLabel&&"string"==typeof t.expandLabel&&(n.expandLabel=t.expandLabel),a.objectConfig=n}return e.options&&Array.isArray(e.options)&&(a.options=e.options.filter(e=>"object"==typeof e&&null!==e&&"string"==typeof e.value&&"string"==typeof e.label).map(e=>({value:e.value,label:e.label}))),void 0!==e.validation&&null!==e.validation&&"object"==typeof e.validation&&(a.validation=e.validation),void 0!==e.multiSelectConfig&&null!==e.multiSelectConfig&&"object"==typeof e.multiSelectConfig&&(a.multiSelectConfig=e.multiSelectConfig),void 0!==e.colorConfig&&null!==e.colorConfig&&"object"==typeof e.colorConfig&&(a.colorConfig=e.colorConfig),void 0!==e.ratingConfig&&null!==e.ratingConfig&&"object"==typeof e.ratingConfig&&(a.ratingConfig=e.ratingConfig),void 0!==e.phoneConfig&&null!==e.phoneConfig&&"object"==typeof e.phoneConfig&&(a.phoneConfig=e.phoneConfig),void 0!==e.datalist&&null!==e.datalist&&"object"==typeof e.datalist&&(a.datalist=e.datalist),a})}}_.ALLOWED_FIELD_TYPES=["text","email","password","url","tel","textarea","select","checkbox","switch","number","date","slider","file","rating","phone","colorPicker","location","duration","multiSelect","autocomplete","masked","object","array","radio"],_.ALLOWED_KEYS=["schema","fields","pages","progress","submitLabel","nextLabel","previousLabel","formClassName","fieldClassName","formOptions","title","description"],_.CONFIG={ZOD_PLACEHOLDER:"__ZOD_SCHEMA__",MAX_RECURSION_DEPTH:10,ENABLE_STRICT_VALIDATION:!0};var z=a(93425);function R(e){let{formCode:t,isStreaming:a=!1,onFormSubmit:r,className:s,title:o="Form Preview",emptyStateMessage:c="No form generated yet. The preview will appear here once a form is created."}=e,d=(0,l.useMemo)(()=>{if(!t)return null;try{console.log("Attempting to parse form code:",{codeLength:t.length,codePreview:t.substring(0,200)+"..."});let e=_.parse(t);return console.log("Successfully parsed form config:",{fieldsCount:e.fields.length,hasSchema:!!e.schema,title:e.title}),e}catch(e){return console.error("Error parsing form configuration:",{error:e instanceof Error?e.message:String(e),formCodePreview:t.substring(0,500)}),null}},[t]);return t||a?(0,n.jsx)(x.Zp,{className:(0,i.cn)("flex flex-col h-full",s),children:(0,n.jsx)(x.Wu,{className:(0,i.cn)("flex-1 overflow-hidden","p-0"),children:(0,n.jsxs)("div",{className:"h-full",children:[a&&!t&&(0,n.jsx)("div",{className:"p-3",children:(0,n.jsxs)(k.Fc,{children:[(0,n.jsx)(S.A,{className:"h-4 w-4"}),(0,n.jsx)(k.TN,{children:"Form is being generated... Please wait for completion."})]})}),t&&d&&(0,n.jsx)(P.b,{config:d,code:t,showModeSelector:!0,showDeviceSelector:!0,onFormSubmit:r,className:"border-0 h-full"}),t&&!d&&(0,n.jsx)("div",{className:"p-3",children:(0,n.jsxs)(k.Fc,{variant:"destructive",children:[(0,n.jsx)(S.A,{className:"h-4 w-4"}),(0,n.jsx)(k.TN,{children:"Failed to parse the form configuration. The form may have invalid syntax."})]})})]})})}):(0,n.jsx)(x.Zp,{className:(0,i.cn)("flex flex-col h-full",s),children:(0,n.jsx)(x.Wu,{className:"flex-1 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,n.jsx)(z.A,{className:"h-12 w-12 mb-4 opacity-50 mx-auto"}),(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No Form Available"}),(0,n.jsx)("p",{className:"text-sm max-w-md",children:c})]})})})}var M=a(85958),Z=a(15870),q=a(27911),K=a(68262);function G(e){let{forms:t,currentFormIndex:a,onFormIndexChange:l,onDeleteForm:r,isStreaming:s=!1,onFormSubmit:o,className:c}=e,d=t[a];return 0!==t.length||s?(0,n.jsxs)(x.Zp,{className:(0,i.cn)("flex flex-col h-full",c),children:[(0,n.jsx)(x.aR,{className:"px-3 pt-1 pb-0",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,n.jsx)(M.A,{className:"h-5 w-5"}),"Preview",t.length>0&&(0,n.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:["(",a+1," of ",t.length,")"]})]}),t.length>1&&(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>l(Math.max(0,a-1)),disabled:0===a,className:"h-8 w-8 p-0",children:[(0,n.jsx)(Z.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Previous form"})]}),(0,n.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>l(Math.min(t.length-1,a+1)),disabled:a===t.length-1,className:"h-8 w-8 p-0",children:[(0,n.jsx)(q.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Next form"})]}),r&&t.length>1&&(0,n.jsxs)(g.$,{variant:"outline",size:"sm",onClick:()=>r(a),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:[(0,n.jsx)(K.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Delete form"})]})]})]})}),(0,n.jsx)(x.Wu,{className:"flex-1 overflow-hidden",children:(0,n.jsx)(R,{formCode:null==d?void 0:d.code,isStreaming:s&&!d,onFormSubmit:o,className:"border-0 h-full"})})]}):(0,n.jsx)(R,{className:c,title:"",emptyStateMessage:"Start a conversation in the chat to generate your first form. The preview will appear here once the AI creates your form."})}var V=a(4595),B=a(24508),$=a(28442);function U(e){let{isCollapsed:t,onToggleCollapse:a,activeView:l,onViewChange:r}=e,s=e=>{l===e?r(null):r(e)};return(0,n.jsxs)("div",{className:"flex flex-col w-12 bg-muted/20 border-r border-border",children:[(0,n.jsxs)(g.$,{variant:"ghost",size:"icon",onClick:a,className:"h-12 w-12 rounded-none border-b border-border hover:bg-muted/40",children:[t?(0,n.jsx)(q.A,{className:"h-4 w-4"}):(0,n.jsx)(Z.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:t?"Expand sidebar":"Collapse sidebar"})]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)(g.$,{variant:"ghost",size:"icon",onClick:()=>s("history"),className:(0,i.cn)("h-12 w-12 rounded-none hover:bg-muted/40","history"===l&&"bg-muted text-foreground"),children:[(0,n.jsx)(V.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"History"})]}),(0,n.jsxs)(g.$,{variant:"ghost",size:"icon",onClick:()=>s("settings"),className:(0,i.cn)("h-12 w-12 rounded-none hover:bg-muted/40","settings"===l&&"bg-muted text-foreground"),children:[(0,n.jsx)(B.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Settings"})]}),(0,n.jsxs)(g.$,{variant:"ghost",size:"icon",onClick:()=>s("provider"),className:(0,i.cn)("h-12 w-12 rounded-none hover:bg-muted/40","provider"===l&&"bg-muted text-foreground"),children:[(0,n.jsx)($.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Provider"})]})]})]})}var J=a(64148),W=a(93385);function H(e){let{conversations:t,currentConversationId:a,onSelectConversation:l,onDeleteConversation:r,onNewConversation:s,onExportConversation:o,className:c}=e,d=e=>{var t;if(e.title)return e.title;let a=null==(t=e.messages)?void 0:t.find(e=>"user"===e.role);if(null==a?void 0:a.content){let e=a.content;return e.length>50?e.substring(0,50)+"...":e}return"New Conversation"};return(0,n.jsxs)(x.Zp,{className:(0,i.cn)("h-full",c),children:[(0,n.jsx)(x.aR,{className:"pb-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,n.jsx)(V.A,{className:"h-5 w-5"}),"Conversation History",(0,n.jsx)(J.E,{variant:"secondary",children:t.length})]}),s&&(0,n.jsxs)(g.$,{variant:"outline",size:"sm",onClick:s,className:"h-8 w-8 p-0",children:[(0,n.jsx)(y.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"New conversation"})]})]})}),(0,n.jsx)(x.Wu,{className:"px-4 pt-0 pb-4",children:(0,n.jsx)("div",{className:"h-[300px] overflow-y-auto",children:0===t.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground py-8",children:[(0,n.jsx)(v.A,{className:"h-8 w-8 mb-2 opacity-50"}),(0,n.jsx)("p",{className:"text-sm",children:"No conversations yet"}),(0,n.jsx)("p",{className:"text-xs",children:"Start a chat to see your history"})]}):(0,n.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,n.jsxs)("div",{className:(0,i.cn)("group flex items-center justify-between gap-2 px-2 py-1.5 rounded hover:bg-muted/50 cursor-pointer text-sm",a===e.id&&"bg-muted"),onClick:()=>l(e),children:[(0,n.jsx)("div",{className:"flex-1 min-w-0",children:(0,n.jsx)("p",{className:"font-medium truncate text-sm",children:d(e)})}),(0,n.jsxs)("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity shrink-0",children:[o&&(0,n.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-5 w-5",onClick:t=>{t.stopPropagation(),o(e)},children:(0,n.jsx)(W.A,{className:"h-3 w-3"})}),(0,n.jsx)(g.$,{type:"button",variant:"ghost",size:"icon",className:"h-5 w-5 text-destructive hover:text-destructive",onClick:t=>{t.stopPropagation(),r(e.id)},children:(0,n.jsx)(K.A,{className:"h-3 w-3"})})]})]},e.id))})})})]})}var Y=a(73297),X=a(42387);let Q=async e=>{let t=await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return(await t.json()).data.filter(e=>e.id&&e.name&&""!==e.id.trim()).map(e=>({value:e.id,label:e.name})).sort((e,t)=>e.label.localeCompare(t.label))},ee=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,l.useMemo)(()=>"openai"===e?[{value:"gpt-5",label:"GPT-5"},{value:"gpt-5-mini",label:"GPT-5 Mini"},{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"}]:"anthropic"===e?[{value:"claude-sonnet-4",label:"Claude Sonnet 4"},{value:"claude-3-5-sonnet-20241022",label:"Claude 3.5 Sonnet"},{value:"claude-3-haiku-20240307",label:"Claude 3 Haiku"}]:"google"===e?[{value:"gemini-2.5-pro",label:"Gemini 2.5 Pro"},{value:"gemini-1.5-pro",label:"Gemini 1.5 Pro"},{value:"gemini-1.5-flash",label:"Gemini 1.5 Flash"}]:"mistral"===e?[{value:"mistral-large-2407",label:"Mistral Large 2407"},{value:"mistral-medium-2312",label:"Mistral Medium 2312"},{value:"mistral-small-2312",label:"Mistral Small 2312"}]:"openrouter"===e?a?[{value:"loading",label:"Loading models..."}]:t.length>0?t.filter(e=>e.value&&""!==e.value.trim()):[{value:"openrouter/kimiplus-k2",label:"OpenRouter Kimi Plus K2"},{value:"moonshotai/moonshot-k2",label:"Moonshot K2"}]:"openai-compatible"===e?[{value:"gpt-4.1-mini",label:"GPT-4.1 Mini"},{value:"custom-model",label:"Custom Model"}]:[],[e,t,a])};function et(e){let{providerConfig:t,onConfigChange:a,className:l}=e,{data:r=[],isLoading:s,error:o}=(0,Y.I)({queryKey:["openrouter-models",null==t?void 0:t.apiKey],queryFn:()=>Q((null==t?void 0:t.apiKey)||""),enabled:(null==t?void 0:t.provider)==="openrouter"&&!!(null==t?void 0:t.apiKey)&&t.apiKey.length>0,staleTime:3e5,gcTime:6e5,retry:1}),i=ee(null==t?void 0:t.provider,r,s),{Form:c}=(0,X.X)({fields:t?[{name:"model",type:"select",label:"Model",placeholder:"Select a model",options:(null==t?void 0:t.provider)==="openrouter"&&o?[{value:"error",label:"Failed to load models - check API key"}]:i},{name:"temperature",type:"slider",label:"Temperature: ".concat(((null==t?void 0:t.temperature)||.7).toFixed(2)),sliderConfig:{min:0,max:1,step:.01},description:"Controls randomness: Focused ← → Creative"},{name:"maxTokens",type:"number",label:"Max Tokens",placeholder:"2000",description:"Maximum response length",numberConfig:{min:1,max:32768}}]:[],formOptions:{defaultValues:{model:(null==t?void 0:t.model)||"",temperature:(null==t?void 0:t.temperature)||.7,maxTokens:(null==t?void 0:t.maxTokens)||2e3},onSubmit:async e=>{let{value:n}=e;t&&a({...t,model:n.model,temperature:n.temperature,maxTokens:n.maxTokens})}},submitLabel:"\uD83D\uDCBE Save Model Settings",showSubmitButton:!!t,autoSubmitOnChange:!1});return(0,n.jsxs)("div",{className:"p-4 space-y-4 ".concat(l||""),children:[(0,n.jsx)("h3",{className:"text-base font-semibold",children:"Model Settings"}),t?(0,n.jsx)(c,{}):(0,n.jsx)("p",{className:"text-muted-foreground",children:"Select a provider first to configure model settings"})]})}let ea=[{value:"openai",label:"OpenAI",requiresKey:!0},{value:"anthropic",label:"Anthropic",requiresKey:!0},{value:"google",label:"Google Gemini",requiresKey:!0},{value:"mistral",label:"Mistral",requiresKey:!0},{value:"openrouter",label:"OpenRouter",requiresKey:!0},{value:"openai-compatible",label:"OpenAI Compatible",requiresKey:!1}];function en(e){let{onConfigChange:t,initialConfig:a,className:l}=e,{Form:r}=(0,X.X)({fields:[{name:"provider",type:"select",label:"Provider",placeholder:"Select provider...",options:ea.map(e=>({value:e.value,label:e.label}))},{name:"apiKey",type:"password",label:"API Key",placeholder:"Enter your API key...",description:"Your API key is stored securely and never sent to our servers"},{name:"endpoint",type:"text",label:"API Endpoint",placeholder:"https://api.example.com/v1",conditional:e=>"openai-compatible"===e.provider,description:"Base URL for OpenAI-compatible API"}],formOptions:{defaultValues:{provider:null==a?void 0:a.provider,apiKey:(null==a?void 0:a.apiKey)||"",endpoint:(null==a?void 0:a.endpoint)||""},onSubmit:async e=>{let{value:a}=e;t({provider:a.provider,apiKey:a.apiKey||"",...a.endpoint&&{endpoint:a.endpoint}})}},submitLabel:"\uD83D\uDCBE Save Configuration",showSubmitButton:!0,autoSubmitOnChange:!1});return(0,n.jsxs)("div",{className:"p-4 space-y-4 ".concat(l||""),children:[(0,n.jsx)("h3",{className:"text-base font-semibold",children:"AI Provider"}),(0,n.jsx)(r,{})]})}function el(e){let{activeView:t,isCollapsed:a,className:l,conversations:r,currentConversationId:s,onSelectConversation:o,onDeleteConversation:c,onNewConversation:d,onExportConversation:m,providerConfig:u,onConfigChange:p}=e;return a||!t?null:(0,n.jsx)("div",{className:(0,i.cn)("w-80 border-r border-border bg-background/50 transition-all duration-200 ease-in-out overflow-hidden",a?"w-0":"w-80",l),children:(0,n.jsx)("div",{className:"h-full p-2",children:(()=>{switch(t){case"history":return(0,n.jsx)(H,{conversations:r,currentConversationId:s,onSelectConversation:o,onDeleteConversation:c,onNewConversation:d,onExportConversation:m,className:"border-0 shadow-none h-full"});case"settings":return(0,n.jsx)(x.Zp,{className:"h-full",children:(0,n.jsx)(et,{providerConfig:u,onConfigChange:p,className:"h-full"})});case"provider":return(0,n.jsx)(x.Zp,{className:"h-full",children:(0,n.jsx)(en,{onConfigChange:p,initialConfig:u,className:"h-full"})});default:return null}})()})})}var er=a(51778);let es=new s.E({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:1}}}),eo={PROVIDER_CONFIG:"formedible-ai-builder-provider-config",CONVERSATIONS:"formedible-ai-builder-conversations",UI_STATE:"formedible-ai-builder-ui-state"};function ei(e){let{className:t,onFormGenerated:a,onFormSubmit:r}=e,[s,o]=(0,l.useState)(null),[c,d]=(0,l.useState)([]),[m,u]=(0,l.useState)(0),[p,h]=(0,l.useState)(!1),[f,g]=(0,l.useState)([]),[b,x]=(0,l.useState)(),[v,y]=(0,l.useState)([]),[j,N]=(0,l.useState)(!1),[w,C]=(0,l.useState)(null),[S,A]=(0,l.useState)(!1);(0,l.useEffect)(()=>{try{let e=localStorage.getItem(eo.PROVIDER_CONFIG);e&&o(JSON.parse(e));let t=localStorage.getItem(eo.CONVERSATIONS),a=[];t&&(a=JSON.parse(t).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),g(a));let n=localStorage.getItem(eo.UI_STATE);if(n){let e=JSON.parse(n);if(N(e.isTopSectionCollapsed||!1),e.currentConversationId&&a.length>0){let t=a.find(t=>t.id===e.currentConversationId);if(t){x(e.currentConversationId),y(t.messages);let a=L(t.messages,t.id,new Date(t.updatedAt));d(a),u(0)}}}}catch(e){console.warn("Failed to load saved AI Builder data:",e)}},[]),(0,l.useEffect)(()=>{if(s)try{localStorage.setItem(eo.PROVIDER_CONFIG,JSON.stringify(s))}catch(e){console.warn("Failed to save provider config:",e)}},[s]),(0,l.useEffect)(()=>{try{localStorage.setItem(eo.CONVERSATIONS,JSON.stringify(f))}catch(e){console.warn("Failed to save conversations:",e)}},[f]),(0,l.useEffect)(()=>{try{localStorage.setItem(eo.UI_STATE,JSON.stringify({isTopSectionCollapsed:j,currentConversationId:b}))}catch(e){console.warn("Failed to save UI state:",e)}},[j,b]);let E=(0,l.useCallback)(e=>{o(e)},[]),k=(0,l.useCallback)(e=>{let t={id:"form_".concat(Date.now()),code:e,timestamp:new Date};d(e=>{let a=[...e,t];return u(a.length-1),a}),null==a||a(e)},[a]),I=(0,l.useCallback)(e=>{h(e)},[]),O=(0,l.useCallback)(e=>{console.log("Form submitted:",e),null==r||r(e)},[r]),T=(0,l.useCallback)(e=>{u(e)},[]),F=(0,l.useCallback)(e=>{d(t=>{let a=t.filter((t,a)=>a!==e);return e<=m&&m>0?u(m-1):e<m||(0===a.length?u(0):m>=a.length&&u(a.length-1)),a})},[m]),P=(0,l.useCallback)(function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],y(e),e.length>0)if(b)g(t=>t.map(t=>t.id===b?{...t,messages:e,updatedAt:new Date}:t));else{let t="conversation_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));g(a=>a.some(e=>e.id===t)?a:[...a,{id:t,title:"",messages:e,createdAt:new Date,updatedAt:new Date}]),x(t)}},[b]),_=(0,l.useCallback)(()=>{x(void 0),y([]),d([]),u(0)},[]),z=(0,l.useCallback)(e=>{x(e.id),y(e.messages);let t=L(e.messages,e.id,new Date(e.updatedAt));console.log("Extracted forms from conversation:",t.length),d(t),u(0)},[]),R=(0,l.useCallback)(e=>{g(t=>t.filter(t=>t.id!==e)),b===e&&(x(void 0),y([]),d([]),u(0))},[b]),M=(0,l.useCallback)(e=>{let t="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),a="conversation-".concat(e.id,".json"),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",a),n.click()},[]),Z=(0,l.useCallback)(()=>{A(!S)},[S]),q=(0,l.useCallback)(e=>{C(e),e&&S&&A(!1)},[S]);return(0,n.jsxs)("div",{className:(0,i.cn)("flex flex-col h-full overflow-hidden",t),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 px-1 pb-1 flex-shrink-0",children:[(0,n.jsx)(er.A,{className:"h-4 w-4 text-primary"}),(0,n.jsx)("h1",{className:"text-lg font-bold text-foreground",children:"AI Form Builder"})]}),(0,n.jsxs)("div",{className:"flex-1 flex min-h-0 overflow-hidden gap-2",children:[(0,n.jsx)(U,{isCollapsed:S,onToggleCollapse:Z,activeView:w,onViewChange:q}),(0,n.jsx)(el,{activeView:w,isCollapsed:S,conversations:f,currentConversationId:b,onSelectConversation:z,onDeleteConversation:R,onNewConversation:_,onExportConversation:M,providerConfig:s,onConfigChange:E}),(0,n.jsxs)("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-2 min-h-0 overflow-hidden",children:[(0,n.jsx)(D,{onFormGenerated:k,onStreamingStateChange:I,onConversationUpdate:P,onNewConversation:_,messages:v,providerConfig:s,className:"h-full overflow-hidden"}),(0,n.jsx)(G,{forms:c,currentFormIndex:m,onFormIndexChange:T,onDeleteForm:F,isStreaming:p,onFormSubmit:O,className:"h-full overflow-hidden"})]})]})]})}function ec(e){return(0,n.jsx)(o.Ht,{client:es,children:(0,n.jsx)(ei,{...e})})}function ed(){return(0,n.jsx)("div",{className:"h-[calc(100vh-4rem)] bg-background",children:(0,n.jsx)(r.P.div,{className:"h-full p-2",initial:{y:30,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},children:(0,n.jsx)("div",{className:"bg-card border rounded-lg shadow-sm h-full p-2",children:(0,n.jsx)(ec,{className:"h-full w-full"})})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[803,46,531,375,800,826,632,624,318,587,315,358],()=>t(24265)),_N_E=e.O()}]);