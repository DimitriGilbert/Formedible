"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[712],{68282:(e,t,n)=>{n.d(t,{ry:()=>eh});var i=n(82267),o=n(55337),r=n(31296),l=r.z.object({error:r.z.object({message:r.z.string(),type:r.z.string().nullish(),param:r.z.any().nullish(),code:r.z.union([r.z.string(),r.z.number()]).nullish()})}),s=(0,i.sl)({errorSchema:l,errorToMessage:e=>e.error.message});function a(e){let t=e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),n=e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini"),i=!(e.startsWith("gpt-3")||e.startsWith("gpt-4")||e.startsWith("chatgpt-4o")||e.startsWith("gpt-5-chat"));return{supportsFlexProcessing:t,supportsPriorityProcessing:n,isReasoningModel:i,systemMessageMode:i?"developer":"system",supportsNonReasoningParameters:e.startsWith("gpt-5.1")||e.startsWith("gpt-5.2")}}function u({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:n?new Date(1e3*n):void 0}}function p(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var d=(0,i.fE)(()=>(0,i.jN)(r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({message:r.z.object({role:r.z.literal("assistant").nullish(),content:r.z.string().nullish(),tool_calls:r.z.array(r.z.object({id:r.z.string().nullish(),type:r.z.literal("function"),function:r.z.object({name:r.z.string(),arguments:r.z.string()})})).nullish(),annotations:r.z.array(r.z.object({type:r.z.literal("url_citation"),url_citation:r.z.object({start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()})})).nullish()}),index:r.z.number(),logprobs:r.z.object({content:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})).nullish()}).nullish(),finish_reason:r.z.string().nullish()})),usage:r.z.object({prompt_tokens:r.z.number().nullish(),completion_tokens:r.z.number().nullish(),total_tokens:r.z.number().nullish(),prompt_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),completion_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish(),accepted_prediction_tokens:r.z.number().nullish(),rejected_prediction_tokens:r.z.number().nullish()}).nullish()}).nullish()}))),c=(0,i.fE)(()=>(0,i.jN)(r.z.union([r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({delta:r.z.object({role:r.z.enum(["assistant"]).nullish(),content:r.z.string().nullish(),tool_calls:r.z.array(r.z.object({index:r.z.number(),id:r.z.string().nullish(),type:r.z.literal("function").nullish(),function:r.z.object({name:r.z.string().nullish(),arguments:r.z.string().nullish()})})).nullish(),annotations:r.z.array(r.z.object({type:r.z.literal("url_citation"),url_citation:r.z.object({start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()})})).nullish()}).nullish(),logprobs:r.z.object({content:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})).nullish()}).nullish(),finish_reason:r.z.string().nullish(),index:r.z.number()})),usage:r.z.object({prompt_tokens:r.z.number().nullish(),completion_tokens:r.z.number().nullish(),total_tokens:r.z.number().nullish(),prompt_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),completion_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish(),accepted_prediction_tokens:r.z.number().nullish(),rejected_prediction_tokens:r.z.number().nullish()}).nullish()}).nullish()}),l]))),m=(0,i.fE)(()=>(0,i.jN)(r.z.object({logitBias:r.z.record(r.z.coerce.number(),r.z.number()).optional(),logprobs:r.z.union([r.z.boolean(),r.z.number()]).optional(),parallelToolCalls:r.z.boolean().optional(),user:r.z.string().optional(),reasoningEffort:r.z.enum(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:r.z.number().optional(),store:r.z.boolean().optional(),metadata:r.z.record(r.z.string().max(64),r.z.string().max(512)).optional(),prediction:r.z.record(r.z.string(),r.z.any()).optional(),structuredOutputs:r.z.boolean().optional(),serviceTier:r.z.enum(["auto","flex","priority","default"]).optional(),strictJsonSchema:r.z.boolean().optional(),textVerbosity:r.z.enum(["low","medium","high"]).optional(),promptCacheKey:r.z.string().optional(),promptCacheRetention:r.z.enum(["in_memory","24h"]).optional(),safetyIdentifier:r.z.string().optional()}))),g=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:l,frequencyPenalty:s,presencePenalty:u,stopSequences:p,responseFormat:d,seed:c,tools:g,toolChoice:h,providerOptions:z}){var _,y,f,b;let v=[],k=null!=(_=await (0,i.xI)({provider:"openai",providerOptions:z,schema:m}))?_:{},x=null==(y=k.structuredOutputs)||y,j=a(this.modelId);null!=l&&v.push({type:"unsupported-setting",setting:"topK"}),(null==d?void 0:d.type)!=="json"||null==d.schema||x||v.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let{messages:w,warnings:I}=function({prompt:e,systemMessageMode:t="system"}){let n=[],r=[];for(let{role:l,content:s}of e)switch(l){case"system":switch(t){case"system":n.push({role:"system",content:s});break;case"developer":n.push({role:"developer",content:s});break;case"remove":r.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":if(1===s.length&&"text"===s[0].type){n.push({role:"user",content:s[0].text});break}n.push({role:"user",content:s.map((e,t)=>{var n,r,l;switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,i.ej)(e.data)}`,detail:null==(r=null==(n=e.providerOptions)?void 0:n.openai)?void 0:r.imageDetail}}}if(e.mediaType.startsWith("audio/")){if(e.data instanceof URL)throw new o.b8({functionality:"audio file parts with URLs"});switch(e.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:(0,i.ej)(e.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:(0,i.ej)(e.data),format:"mp3"}};default:throw new o.b8({functionality:`audio content parts with media type ${e.mediaType}`})}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new o.b8({functionality:"PDF file parts with URLs"});return{type:"file",file:"string"==typeof e.data&&e.data.startsWith("file-")?{file_id:e.data}:{filename:null!=(l=e.filename)?l:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,i.ej)(e.data)}`}}}else throw new o.b8({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e="",t=[];for(let n of s)switch(n.type){case"text":e+=n.text;break;case"tool-call":t.push({id:n.toolCallId,type:"function",function:{name:n.toolName,arguments:JSON.stringify(n.input)}})}n.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0});break}case"tool":for(let e of s){let t,i=e.output;switch(i.type){case"text":case"error-text":t=i.value;break;case"content":case"json":case"error-json":t=JSON.stringify(i.value)}n.push({role:"tool",tool_call_id:e.toolCallId,content:t})}break;default:throw Error(`Unsupported role: ${l}`)}return{messages:n,warnings:r}}({prompt:e,systemMessageMode:j.systemMessageMode});v.push(...I);let q=null!=(f=k.strictJsonSchema)&&f,C={model:this.modelId,logit_bias:k.logitBias,logprobs:!0===k.logprobs||"number"==typeof k.logprobs||void 0,top_logprobs:"number"==typeof k.logprobs?k.logprobs:"boolean"==typeof k.logprobs&&k.logprobs?0:void 0,user:k.user,parallel_tool_calls:k.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:s,presence_penalty:u,response_format:(null==d?void 0:d.type)==="json"?x&&null!=d.schema?{type:"json_schema",json_schema:{schema:d.schema,strict:q,name:null!=(b=d.name)?b:"response",description:d.description}}:{type:"json_object"}:void 0,stop:p,seed:c,verbosity:k.textVerbosity,max_completion_tokens:k.maxCompletionTokens,store:k.store,metadata:k.metadata,prediction:k.prediction,reasoning_effort:k.reasoningEffort,service_tier:k.serviceTier,prompt_cache_key:k.promptCacheKey,prompt_cache_retention:k.promptCacheRetention,safety_identifier:k.safetyIdentifier,messages:w};j.isReasoningModel?("none"===k.reasoningEffort&&j.supportsNonReasoningParameters||(null!=C.temperature&&(C.temperature=void 0,v.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=C.top_p&&(C.top_p=void 0,v.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=C.logprobs&&(C.logprobs=void 0,v.push({type:"other",message:"logprobs is not supported for reasoning models"}))),null!=C.frequency_penalty&&(C.frequency_penalty=void 0,v.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=C.presence_penalty&&(C.presence_penalty=void 0,v.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=C.logit_bias&&(C.logit_bias=void 0,v.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=C.top_logprobs&&(C.top_logprobs=void 0,v.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=C.max_tokens&&(null==C.max_completion_tokens&&(C.max_completion_tokens=C.max_tokens),C.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=C.temperature&&(C.temperature=void 0,v.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),"flex"!==k.serviceTier||j.supportsFlexProcessing||(v.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),C.service_tier=void 0),"priority"!==k.serviceTier||j.supportsPriorityProcessing||(v.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),C.service_tier=void 0);let{tools:N,toolChoice:T,toolWarnings:S}=function({tools:e,toolChoice:t,structuredOutputs:n,strictJsonSchema:i}){e=(null==e?void 0:e.length)?e:void 0;let r=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:r};let l=[];for(let t of e)"function"===t.type?l.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:n?i:void 0}}):r.push({type:"unsupported-tool",tool:t});if(null==t)return{tools:l,toolChoice:void 0,toolWarnings:r};let s=t.type;switch(s){case"auto":case"none":case"required":return{tools:l,toolChoice:s,toolWarnings:r};case"tool":return{tools:l,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:r};default:throw new o.b8({functionality:`tool choice type: ${s}`})}}({tools:g,toolChoice:h,structuredOutputs:x,strictJsonSchema:q});return{args:{...C,tools:N,tool_choice:T},warnings:[...v,...S]}}async doGenerate(e){var t,n,o,r,l,a,c,m,g,h,z,_,y,f;let{args:b,warnings:v}=await this.getArgs(e),{responseHeaders:k,value:x,rawValue:j}=await (0,i.GU)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),body:b,failedResponseHandler:s,successfulResponseHandler:(0,i.cV)(d),abortSignal:e.abortSignal,fetch:this.config.fetch}),w=x.choices[0],I=[],q=w.message.content;for(let e of(null!=q&&q.length>0&&I.push({type:"text",text:q}),null!=(t=w.message.tool_calls)?t:[]))I.push({type:"tool-call",toolCallId:null!=(n=e.id)?n:(0,i.$C)(),toolName:e.function.name,input:e.function.arguments});for(let e of null!=(o=w.message.annotations)?o:[])I.push({type:"source",sourceType:"url",id:(0,i.$C)(),url:e.url_citation.url,title:e.url_citation.title});let C=null==(r=x.usage)?void 0:r.completion_tokens_details,N=null==(l=x.usage)?void 0:l.prompt_tokens_details,T={openai:{}};return(null==C?void 0:C.accepted_prediction_tokens)!=null&&(T.openai.acceptedPredictionTokens=null==C?void 0:C.accepted_prediction_tokens),(null==C?void 0:C.rejected_prediction_tokens)!=null&&(T.openai.rejectedPredictionTokens=null==C?void 0:C.rejected_prediction_tokens),(null==(a=w.logprobs)?void 0:a.content)!=null&&(T.openai.logprobs=w.logprobs.content),{content:I,finishReason:p(w.finish_reason),usage:{inputTokens:null!=(m=null==(c=x.usage)?void 0:c.prompt_tokens)?m:void 0,outputTokens:null!=(h=null==(g=x.usage)?void 0:g.completion_tokens)?h:void 0,totalTokens:null!=(_=null==(z=x.usage)?void 0:z.total_tokens)?_:void 0,reasoningTokens:null!=(y=null==C?void 0:C.reasoning_tokens)?y:void 0,cachedInputTokens:null!=(f=null==N?void 0:N.cached_tokens)?f:void 0},request:{body:b},response:{...u(x),headers:k,body:j},warnings:v,providerMetadata:T}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:l,value:a}=await (0,i.GU)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),body:r,failedResponseHandler:s,successfulResponseHandler:(0,i.Ds)(c),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=[],m="unknown",g={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},h=!1,z=!1,_={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var r,l,s,a,c,y,f,b,v,k,x,j,w,I,q,C,N,T,S,$,E,R,P,U;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){m="error",n.enqueue({type:"error",error:t.error});return}let M=t.value;if("error"in M){m="error",n.enqueue({type:"error",error:M.error});return}!h&&Object.values(u(M)).some(Boolean)&&(h=!0,n.enqueue({type:"response-metadata",...u(M)})),null!=M.usage&&(g.inputTokens=null!=(r=M.usage.prompt_tokens)?r:void 0,g.outputTokens=null!=(l=M.usage.completion_tokens)?l:void 0,g.totalTokens=null!=(s=M.usage.total_tokens)?s:void 0,g.reasoningTokens=null!=(c=null==(a=M.usage.completion_tokens_details)?void 0:a.reasoning_tokens)?c:void 0,g.cachedInputTokens=null!=(f=null==(y=M.usage.prompt_tokens_details)?void 0:y.cached_tokens)?f:void 0,(null==(b=M.usage.completion_tokens_details)?void 0:b.accepted_prediction_tokens)!=null&&(_.openai.acceptedPredictionTokens=null==(v=M.usage.completion_tokens_details)?void 0:v.accepted_prediction_tokens),(null==(k=M.usage.completion_tokens_details)?void 0:k.rejected_prediction_tokens)!=null&&(_.openai.rejectedPredictionTokens=null==(x=M.usage.completion_tokens_details)?void 0:x.rejected_prediction_tokens));let O=M.choices[0];if((null==O?void 0:O.finish_reason)!=null&&(m=p(O.finish_reason)),(null==(j=null==O?void 0:O.logprobs)?void 0:j.content)!=null&&(_.openai.logprobs=O.logprobs.content),(null==O?void 0:O.delta)==null)return;let D=O.delta;if(null!=D.content&&(z||(n.enqueue({type:"text-start",id:"0"}),z=!0),n.enqueue({type:"text-delta",id:"0",delta:D.content})),null!=D.tool_calls)for(let e of D.tool_calls){let t=e.index;if(null==d[t]){if("function"!==e.type)throw new o.xn({data:e,message:"Expected 'function' type."});if(null==e.id)throw new o.xn({data:e,message:"Expected 'id' to be a string."});if((null==(w=e.function)?void 0:w.name)==null)throw new o.xn({data:e,message:"Expected 'function.name' to be a string."});n.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),d[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(I=e.function.arguments)?I:""},hasFinished:!1};let r=d[t];(null==(q=r.function)?void 0:q.name)!=null&&(null==(C=r.function)?void 0:C.arguments)!=null&&(r.function.arguments.length>0&&n.enqueue({type:"tool-input-delta",id:r.id,delta:r.function.arguments}),(0,i.v0)(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(N=r.id)?N:(0,i.$C)(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=d[t];!r.hasFinished&&((null==(T=e.function)?void 0:T.arguments)!=null&&(r.function.arguments+=null!=($=null==(S=e.function)?void 0:S.arguments)?$:""),n.enqueue({type:"tool-input-delta",id:r.id,delta:null!=(E=e.function.arguments)?E:""}),(null==(R=r.function)?void 0:R.name)!=null&&(null==(P=r.function)?void 0:P.arguments)!=null&&(0,i.v0)(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(U=r.id)?U:(0,i.$C)(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0))}if(null!=D.annotations)for(let e of D.annotations)n.enqueue({type:"source",sourceType:"url",id:(0,i.$C)(),url:e.url_citation.url,title:e.url_citation.title})},flush(e){z&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:m,usage:g,...null!=_?{providerMetadata:_}:{}})}})),request:{body:r},response:{headers:l}}}};function h({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function z(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var _=(0,i.fE)(()=>(0,i.jN)(r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({text:r.z.string(),finish_reason:r.z.string(),logprobs:r.z.object({tokens:r.z.array(r.z.string()),token_logprobs:r.z.array(r.z.number()),top_logprobs:r.z.array(r.z.record(r.z.string(),r.z.number())).nullish()}).nullish()})),usage:r.z.object({prompt_tokens:r.z.number(),completion_tokens:r.z.number(),total_tokens:r.z.number()}).nullish()}))),y=(0,i.fE)(()=>(0,i.jN)(r.z.union([r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({text:r.z.string(),finish_reason:r.z.string().nullish(),index:r.z.number(),logprobs:r.z.object({tokens:r.z.array(r.z.string()),token_logprobs:r.z.array(r.z.number()),top_logprobs:r.z.array(r.z.record(r.z.string(),r.z.number())).nullish()}).nullish()})),usage:r.z.object({prompt_tokens:r.z.number(),completion_tokens:r.z.number(),total_tokens:r.z.number()}).nullish()}),l]))),f=(0,i.fE)(()=>(0,i.jN)(r.z.object({echo:r.z.boolean().optional(),logitBias:r.z.record(r.z.string(),r.z.number()).optional(),suffix:r.z.string().optional(),user:r.z.string().optional(),logprobs:r.z.union([r.z.boolean(),r.z.number()]).optional()}))),b=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:l,frequencyPenalty:s,presencePenalty:a,stopSequences:u,responseFormat:p,tools:d,toolChoice:c,seed:m,providerOptions:g}){let h=[],z={...await (0,i.xI)({provider:"openai",providerOptions:g,schema:f}),...await (0,i.xI)({provider:this.providerOptionsName,providerOptions:g,schema:f})};null!=l&&h.push({type:"unsupported-setting",setting:"topK"}),(null==d?void 0:d.length)&&h.push({type:"unsupported-setting",setting:"tools"}),null!=c&&h.push({type:"unsupported-setting",setting:"toolChoice"}),null!=p&&"text"!==p.type&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:_,stopSequences:y}=function({prompt:e,user:t="user",assistant:n="assistant"}){let i="";for(let{role:r,content:l}of("system"===e[0].role&&(i+=`${e[0].content}

`,e=e.slice(1)),e))switch(r){case"system":throw new o.M3({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=l.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("");i+=`${t}:
${e}

`;break}case"assistant":{let e=l.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new o.b8({functionality:"tool-call messages"})}}).join("");i+=`${n}:
${e}

`;break}case"tool":throw new o.b8({functionality:"tool messages"});default:throw Error(`Unsupported role: ${r}`)}return{prompt:i+=`${n}:
`,stopSequences:[`
${t}:`]}}({prompt:e}),b=[...null!=y?y:[],...null!=u?u:[]];return{args:{model:this.modelId,echo:z.echo,logit_bias:z.logitBias,logprobs:(null==z?void 0:z.logprobs)===!0?0:(null==z?void 0:z.logprobs)===!1||null==z?void 0:z.logprobs,suffix:z.suffix,user:z.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:s,presence_penalty:a,seed:m,prompt:_,stop:b.length>0?b:void 0},warnings:h}}async doGenerate(e){var t,n,o;let{args:r,warnings:l}=await this.getArgs(e),{responseHeaders:a,value:u,rawValue:p}=await (0,i.GU)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),body:r,failedResponseHandler:s,successfulResponseHandler:(0,i.cV)(_),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=u.choices[0],c={openai:{}};return null!=d.logprobs&&(c.openai.logprobs=d.logprobs),{content:[{type:"text",text:d.text}],usage:{inputTokens:null==(t=u.usage)?void 0:t.prompt_tokens,outputTokens:null==(n=u.usage)?void 0:n.completion_tokens,totalTokens:null==(o=u.usage)?void 0:o.total_tokens},finishReason:z(d.finish_reason),request:{body:r},response:{...h(u),headers:a,body:p},providerMetadata:c,warnings:l}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),o={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:r,value:l}=await (0,i.GU)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),body:o,failedResponseHandler:s,successfulResponseHandler:(0,i.Ds)(y),abortSignal:e.abortSignal,fetch:this.config.fetch}),a="unknown",u={openai:{}},p={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},d=!0;return{stream:l.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){a="error",n.enqueue({type:"error",error:t.error});return}let i=t.value;if("error"in i){a="error",n.enqueue({type:"error",error:i.error});return}d&&(d=!1,n.enqueue({type:"response-metadata",...h(i)}),n.enqueue({type:"text-start",id:"0"})),null!=i.usage&&(p.inputTokens=i.usage.prompt_tokens,p.outputTokens=i.usage.completion_tokens,p.totalTokens=i.usage.total_tokens);let o=i.choices[0];(null==o?void 0:o.finish_reason)!=null&&(a=z(o.finish_reason)),(null==o?void 0:o.logprobs)!=null&&(u.openai.logprobs=o.logprobs),(null==o?void 0:o.text)!=null&&o.text.length>0&&n.enqueue({type:"text-delta",id:"0",delta:o.text})},flush(e){d||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:a,providerMetadata:u,usage:p})}})),request:{body:o},response:{headers:r}}}},v=(0,i.fE)(()=>(0,i.jN)(r.z.object({dimensions:r.z.number().optional(),user:r.z.string().optional()}))),k=(0,i.fE)(()=>(0,i.jN)(r.z.object({data:r.z.array(r.z.object({embedding:r.z.array(r.z.number())})),usage:r.z.object({prompt_tokens:r.z.number()}).nullish()}))),x=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var l;if(e.length>this.maxEmbeddingsPerCall)throw new o.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let a=null!=(l=await (0,i.xI)({provider:"openai",providerOptions:r,schema:v}))?l:{},{responseHeaders:u,value:p,rawValue:d}=await (0,i.GU)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:a.dimensions,user:a.user},failedResponseHandler:s,successfulResponseHandler:(0,i.cV)(k),abortSignal:n,fetch:this.config.fetch});return{embeddings:p.data.map(e=>e.embedding),usage:p.usage?{tokens:p.usage.prompt_tokens}:void 0,response:{headers:u,body:d}}}},j=(0,i.fE)(()=>(0,i.jN)(r.z.object({created:r.z.number().nullish(),data:r.z.array(r.z.object({b64_json:r.z.string(),revised_prompt:r.z.string().nullish()})),background:r.z.string().nullish(),output_format:r.z.string().nullish(),size:r.z.string().nullish(),quality:r.z.string().nullish(),usage:r.z.object({input_tokens:r.z.number().nullish(),output_tokens:r.z.number().nullish(),total_tokens:r.z.number().nullish(),input_tokens_details:r.z.object({image_tokens:r.z.number().nullish(),text_tokens:r.z.number().nullish()}).nullish()}).nullish()}))),w={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},I=new Set(["gpt-image-1","gpt-image-1-mini","gpt-image-1.5"]),q=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return null!=(e=w[this.modelId])?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:o,seed:r,providerOptions:l,headers:a,abortSignal:u}){var p,d,c,m;let g=[];null!=o&&g.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=r&&g.push({type:"unsupported-setting",setting:"seed"});let h=null!=(c=null==(d=null==(p=this.config._internal)?void 0:p.currentDate)?void 0:d.call(p))?c:new Date,{value:z,responseHeaders:_}=await (0,i.GU)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),a),body:{model:this.modelId,prompt:e,n:t,size:n,...null!=(m=l.openai)?m:{},...!I.has(this.modelId)?{response_format:"b64_json"}:{}},failedResponseHandler:s,successfulResponseHandler:(0,i.cV)(j),abortSignal:u,fetch:this.config.fetch});return{images:z.data.map(e=>e.b64_json),warnings:g,response:{timestamp:h,modelId:this.modelId,headers:_},providerMetadata:{openai:{images:z.data.map(e=>({...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},...null!=z.created?{created:z.created}:{},...null!=z.size?{size:z.size}:{},...null!=z.quality?{quality:z.quality}:{},...null!=z.background?{background:z.background}:{},...null!=z.output_format?{outputFormat:z.output_format}:{}}))}}}}},C=(0,i.ID)(()=>(0,i.jN)(r.z.object({code:r.z.string().nullish(),containerId:r.z.string()}))),N=(0,i.ID)(()=>(0,i.jN)(r.z.object({outputs:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("logs"),logs:r.z.string()}),r.z.object({type:r.z.literal("image"),url:r.z.string()})])).nullish()}))),T=(0,i.ID)(()=>(0,i.jN)(r.z.object({container:r.z.union([r.z.string(),r.z.object({fileIds:r.z.array(r.z.string()).optional()})]).optional()}))),S=(0,i.J2)({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:C,outputSchema:N}),$=r.z.object({key:r.z.string(),type:r.z.enum(["eq","ne","gt","gte","lt","lte","in","nin"]),value:r.z.union([r.z.string(),r.z.number(),r.z.boolean(),r.z.array(r.z.string())])}),E=r.z.object({type:r.z.enum(["and","or"]),filters:r.z.array(r.z.union([$,r.z.lazy(()=>E)]))}),R=(0,i.ID)(()=>(0,i.jN)(r.z.object({vectorStoreIds:r.z.array(r.z.string()),maxNumResults:r.z.number().optional(),ranking:r.z.object({ranker:r.z.string().optional(),scoreThreshold:r.z.number().optional()}).optional(),filters:r.z.union([$,E]).optional()}))),P=(0,i.ID)(()=>(0,i.jN)(r.z.object({queries:r.z.array(r.z.string()),results:r.z.array(r.z.object({attributes:r.z.record(r.z.string(),r.z.unknown()),fileId:r.z.string(),filename:r.z.string(),score:r.z.number(),text:r.z.string()})).nullable()}))),U=(0,i.J2)({id:"openai.file_search",name:"file_search",inputSchema:r.z.object({}),outputSchema:P}),M=(0,i.ID)(()=>(0,i.jN)(r.z.object({background:r.z.enum(["auto","opaque","transparent"]).optional(),inputFidelity:r.z.enum(["low","high"]).optional(),inputImageMask:r.z.object({fileId:r.z.string().optional(),imageUrl:r.z.string().optional()}).optional(),model:r.z.string().optional(),moderation:r.z.enum(["auto"]).optional(),outputCompression:r.z.number().int().min(0).max(100).optional(),outputFormat:r.z.enum(["png","jpeg","webp"]).optional(),partialImages:r.z.number().int().min(0).max(3).optional(),quality:r.z.enum(["auto","low","medium","high"]).optional(),size:r.z.enum(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),O=(0,i.ID)(()=>(0,i.jN)(r.z.object({}))),D=(0,i.ID)(()=>(0,i.jN)(r.z.object({result:r.z.string()}))),V=(0,i.J2)({id:"openai.image_generation",name:"image_generation",inputSchema:O,outputSchema:D}),A=(0,i.ID)(()=>(0,i.jN)(r.z.object({action:r.z.object({type:r.z.literal("exec"),command:r.z.array(r.z.string()),timeoutMs:r.z.number().optional(),user:r.z.string().optional(),workingDirectory:r.z.string().optional(),env:r.z.record(r.z.string(),r.z.string()).optional()})}))),W=(0,i.ID)(()=>(0,i.jN)(r.z.object({output:r.z.string()}))),J=(0,i.J2)({id:"openai.local_shell",name:"local_shell",inputSchema:A,outputSchema:W}),H=(0,i.ID)(()=>(0,i.jN)(r.z.object({externalWebAccess:r.z.boolean().optional(),filters:r.z.object({allowedDomains:r.z.array(r.z.string()).optional()}).optional(),searchContextSize:r.z.enum(["low","medium","high"]).optional(),userLocation:r.z.object({type:r.z.literal("approximate"),country:r.z.string().optional(),city:r.z.string().optional(),region:r.z.string().optional(),timezone:r.z.string().optional()}).optional()}))),G=(0,i.ID)(()=>(0,i.jN)(r.z.object({}))),L=(0,i.ID)(()=>(0,i.jN)(r.z.object({action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().optional()}),r.z.object({type:r.z.literal("openPage"),url:r.z.string().nullish()}),r.z.object({type:r.z.literal("findInPage"),url:r.z.string().nullish(),pattern:r.z.string().nullish()})]),sources:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url"),url:r.z.string()}),r.z.object({type:r.z.literal("api"),name:r.z.string()})])).optional()}))),F=(0,i.J2)({id:"openai.web_search",name:"web_search",inputSchema:G,outputSchema:L}),B=(0,i.ID)(()=>(0,i.jN)(r.z.object({searchContextSize:r.z.enum(["low","medium","high"]).optional(),userLocation:r.z.object({type:r.z.literal("approximate"),country:r.z.string().optional(),city:r.z.string().optional(),region:r.z.string().optional(),timezone:r.z.string().optional()}).optional()}))),K=(0,i.ID)(()=>(0,i.jN)(r.z.object({}))),Z=(0,i.ID)(()=>(0,i.jN)(r.z.object({action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().optional()}),r.z.object({type:r.z.literal("openPage"),url:r.z.string().nullish()}),r.z.object({type:r.z.literal("findInPage"),url:r.z.string().nullish(),pattern:r.z.string().nullish()})])}))),Q={codeInterpreter:(e={})=>S(e),fileSearch:U,imageGeneration:(e={})=>V(e),localShell:J,webSearchPreview:(0,i.J2)({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:K,outputSchema:Z}),webSearch:(e={})=>F(e)};function Y(e,t){return!!t&&t.some(t=>e.startsWith(t))}async function X({prompt:e,systemMessageMode:t,fileIdPrefixes:n,store:r,hasLocalShellTool:l=!1}){var s,a,u,p;let d=[],c=[];for(let{role:m,content:g}of e)switch(m){case"system":switch(t){case"system":d.push({role:"system",content:g});break;case"developer":d.push({role:"developer",content:g});break;case"remove":c.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":d.push({role:"user",content:g.map((e,t)=>{var r,l,s;switch(e.type){case"text":return{type:"input_text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"input_image",...e.data instanceof URL?{image_url:e.data.toString()}:"string"==typeof e.data&&Y(e.data,n)?{file_id:e.data}:{image_url:`data:${t};base64,${(0,i.ej)(e.data)}`},detail:null==(l=null==(r=e.providerOptions)?void 0:r.openai)?void 0:l.imageDetail}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)return{type:"input_file",file_url:e.data.toString()};return{type:"input_file",..."string"==typeof e.data&&Y(e.data,n)?{file_id:e.data}:{filename:null!=(s=e.filename)?s:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,i.ej)(e.data)}`}}}throw new o.b8({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e={},t={};for(let n of g)switch(n.type){case"text":{let e=null==(a=null==(s=n.providerOptions)?void 0:s.openai)?void 0:a.itemId;if(r&&null!=e){d.push({type:"item_reference",id:e});break}d.push({role:"assistant",content:[{type:"output_text",text:n.text}],id:e});break}case"tool-call":{if(t[n.toolCallId]=n,n.providerExecuted)break;let e=null==(p=null==(u=n.providerOptions)?void 0:u.openai)?void 0:p.itemId;if(r&&null!=e){d.push({type:"item_reference",id:e});break}if(l&&"local_shell"===n.toolName){let t=await (0,i.k5)({value:n.input,schema:A});d.push({type:"local_shell_call",call_id:n.toolCallId,id:e,action:{type:"exec",command:t.action.command,timeout_ms:t.action.timeoutMs,user:t.action.user,working_directory:t.action.workingDirectory,env:t.action.env}});break}d.push({type:"function_call",call_id:n.toolCallId,name:n.toolName,arguments:JSON.stringify(n.input),id:e});break}case"tool-result":r?d.push({type:"item_reference",id:n.toolCallId}):c.push({type:"other",message:`Results for OpenAI tool ${n.toolName} are not sent to the API when store is false`});break;case"reasoning":{let t=await (0,i.xI)({provider:"openai",providerOptions:n.providerOptions,schema:ee}),o=null==t?void 0:t.itemId;if(null!=o){let i=e[o];if(r)void 0===i&&(d.push({type:"item_reference",id:o}),e[o]={type:"reasoning",id:o,summary:[]});else{let r=[];n.text.length>0?r.push({type:"summary_text",text:n.text}):void 0!==i&&c.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(n)}.`}),void 0===i?(e[o]={type:"reasoning",id:o,encrypted_content:null==t?void 0:t.reasoningEncryptedContent,summary:r},d.push(e[o])):(i.summary.push(...r),(null==t?void 0:t.reasoningEncryptedContent)!=null&&(i.encrypted_content=t.reasoningEncryptedContent))}}else c.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(n)}.`})}}break}case"tool":for(let e of g){let t,n=e.output;if(l&&"local_shell"===e.toolName&&"json"===n.type){let t=await (0,i.k5)({value:n.value,schema:W});d.push({type:"local_shell_call_output",call_id:e.toolCallId,output:t.output});break}switch(n.type){case"text":case"error-text":t=n.value;break;case"json":case"error-json":t=JSON.stringify(n.value);break;case"content":t=n.value.map(e=>{switch(e.type){case"text":return{type:"input_text",text:e.text};case"media":return e.mediaType.startsWith("image/")?{type:"input_image",image_url:`data:${e.mediaType};base64,${e.data}`}:{type:"input_file",filename:"data",file_data:`data:${e.mediaType};base64,${e.data}`}}})}d.push({type:"function_call_output",call_id:e.toolCallId,output:t})}break;default:throw Error(`Unsupported role: ${m}`)}return{input:d,warnings:c}}var ee=r.z.object({itemId:r.z.string().nullish(),reasoningEncryptedContent:r.z.string().nullish()});function et({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var en=(0,i.fE)(()=>(0,i.jN)(r.z.union([r.z.object({type:r.z.literal("response.output_text.delta"),item_id:r.z.string(),delta:r.z.string(),logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})).nullish()}),r.z.object({type:r.z.enum(["response.completed","response.incomplete"]),response:r.z.object({incomplete_details:r.z.object({reason:r.z.string()}).nullish(),usage:r.z.object({input_tokens:r.z.number(),input_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),output_tokens:r.z.number(),output_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish()}).nullish()}),service_tier:r.z.string().nullish()})}),r.z.object({type:r.z.literal("response.created"),response:r.z.object({id:r.z.string(),created_at:r.z.number(),model:r.z.string(),service_tier:r.z.string().nullish()})}),r.z.object({type:r.z.literal("response.output_item.added"),output_index:r.z.number(),item:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("message"),id:r.z.string()}),r.z.object({type:r.z.literal("reasoning"),id:r.z.string(),encrypted_content:r.z.string().nullish()}),r.z.object({type:r.z.literal("function_call"),id:r.z.string(),call_id:r.z.string(),name:r.z.string(),arguments:r.z.string()}),r.z.object({type:r.z.literal("web_search_call"),id:r.z.string(),status:r.z.string()}),r.z.object({type:r.z.literal("computer_call"),id:r.z.string(),status:r.z.string()}),r.z.object({type:r.z.literal("file_search_call"),id:r.z.string()}),r.z.object({type:r.z.literal("image_generation_call"),id:r.z.string()}),r.z.object({type:r.z.literal("code_interpreter_call"),id:r.z.string(),container_id:r.z.string(),code:r.z.string().nullable(),outputs:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("logs"),logs:r.z.string()}),r.z.object({type:r.z.literal("image"),url:r.z.string()})])).nullable(),status:r.z.string()})])}),r.z.object({type:r.z.literal("response.output_item.done"),output_index:r.z.number(),item:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("message"),id:r.z.string()}),r.z.object({type:r.z.literal("reasoning"),id:r.z.string(),encrypted_content:r.z.string().nullish()}),r.z.object({type:r.z.literal("function_call"),id:r.z.string(),call_id:r.z.string(),name:r.z.string(),arguments:r.z.string(),status:r.z.literal("completed")}),r.z.object({type:r.z.literal("code_interpreter_call"),id:r.z.string(),code:r.z.string().nullable(),container_id:r.z.string(),outputs:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("logs"),logs:r.z.string()}),r.z.object({type:r.z.literal("image"),url:r.z.string()})])).nullable()}),r.z.object({type:r.z.literal("image_generation_call"),id:r.z.string(),result:r.z.string()}),r.z.object({type:r.z.literal("web_search_call"),id:r.z.string(),status:r.z.string(),action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().nullish(),sources:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url"),url:r.z.string()}),r.z.object({type:r.z.literal("api"),name:r.z.string()})])).nullish()}),r.z.object({type:r.z.literal("open_page"),url:r.z.string().nullish()}),r.z.object({type:r.z.literal("find_in_page"),url:r.z.string().nullish(),pattern:r.z.string().nullish()})])}),r.z.object({type:r.z.literal("file_search_call"),id:r.z.string(),queries:r.z.array(r.z.string()),results:r.z.array(r.z.object({attributes:r.z.record(r.z.string(),r.z.unknown()),file_id:r.z.string(),filename:r.z.string(),score:r.z.number(),text:r.z.string()})).nullish()}),r.z.object({type:r.z.literal("local_shell_call"),id:r.z.string(),call_id:r.z.string(),action:r.z.object({type:r.z.literal("exec"),command:r.z.array(r.z.string()),timeout_ms:r.z.number().optional(),user:r.z.string().optional(),working_directory:r.z.string().optional(),env:r.z.record(r.z.string(),r.z.string()).optional()})}),r.z.object({type:r.z.literal("computer_call"),id:r.z.string(),status:r.z.literal("completed")})])}),r.z.object({type:r.z.literal("response.function_call_arguments.delta"),item_id:r.z.string(),output_index:r.z.number(),delta:r.z.string()}),r.z.object({type:r.z.literal("response.image_generation_call.partial_image"),item_id:r.z.string(),output_index:r.z.number(),partial_image_b64:r.z.string()}),r.z.object({type:r.z.literal("response.code_interpreter_call_code.delta"),item_id:r.z.string(),output_index:r.z.number(),delta:r.z.string()}),r.z.object({type:r.z.literal("response.code_interpreter_call_code.done"),item_id:r.z.string(),output_index:r.z.number(),code:r.z.string()}),r.z.object({type:r.z.literal("response.output_text.annotation.added"),annotation:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url_citation"),start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()}),r.z.object({type:r.z.literal("file_citation"),file_id:r.z.string(),filename:r.z.string().nullish(),index:r.z.number().nullish(),start_index:r.z.number().nullish(),end_index:r.z.number().nullish(),quote:r.z.string().nullish()})])}),r.z.object({type:r.z.literal("response.reasoning_summary_part.added"),item_id:r.z.string(),summary_index:r.z.number()}),r.z.object({type:r.z.literal("response.reasoning_summary_text.delta"),item_id:r.z.string(),summary_index:r.z.number(),delta:r.z.string()}),r.z.object({type:r.z.literal("response.reasoning_summary_part.done"),item_id:r.z.string(),summary_index:r.z.number()}),r.z.object({type:r.z.literal("error"),sequence_number:r.z.number(),error:r.z.object({type:r.z.string(),code:r.z.string(),message:r.z.string(),param:r.z.string().nullish()})}),r.z.object({type:r.z.string()}).loose().transform(e=>({type:"unknown_chunk",message:e.type}))]))),ei=(0,i.fE)(()=>(0,i.jN)(r.z.object({id:r.z.string().optional(),created_at:r.z.number().optional(),error:r.z.object({message:r.z.string(),type:r.z.string(),param:r.z.string().nullish(),code:r.z.string()}).nullish(),model:r.z.string().optional(),output:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("message"),role:r.z.literal("assistant"),id:r.z.string(),content:r.z.array(r.z.object({type:r.z.literal("output_text"),text:r.z.string(),logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})).nullish(),annotations:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url_citation"),start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()}),r.z.object({type:r.z.literal("file_citation"),file_id:r.z.string(),filename:r.z.string().nullish(),index:r.z.number().nullish(),start_index:r.z.number().nullish(),end_index:r.z.number().nullish(),quote:r.z.string().nullish()}),r.z.object({type:r.z.literal("container_file_citation"),container_id:r.z.string(),file_id:r.z.string(),filename:r.z.string().nullish(),start_index:r.z.number().nullish(),end_index:r.z.number().nullish(),index:r.z.number().nullish()}),r.z.object({type:r.z.literal("file_path"),file_id:r.z.string(),index:r.z.number().nullish()})]))}))}),r.z.object({type:r.z.literal("web_search_call"),id:r.z.string(),status:r.z.string(),action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().nullish(),sources:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url"),url:r.z.string()}),r.z.object({type:r.z.literal("api"),name:r.z.string()})])).nullish()}),r.z.object({type:r.z.literal("open_page"),url:r.z.string().nullish()}),r.z.object({type:r.z.literal("find_in_page"),url:r.z.string().nullish(),pattern:r.z.string().nullish()})])}),r.z.object({type:r.z.literal("file_search_call"),id:r.z.string(),queries:r.z.array(r.z.string()),results:r.z.array(r.z.object({attributes:r.z.record(r.z.string(),r.z.union([r.z.string(),r.z.number(),r.z.boolean()])),file_id:r.z.string(),filename:r.z.string(),score:r.z.number(),text:r.z.string()})).nullish()}),r.z.object({type:r.z.literal("code_interpreter_call"),id:r.z.string(),code:r.z.string().nullable(),container_id:r.z.string(),outputs:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("logs"),logs:r.z.string()}),r.z.object({type:r.z.literal("image"),url:r.z.string()})])).nullable()}),r.z.object({type:r.z.literal("image_generation_call"),id:r.z.string(),result:r.z.string()}),r.z.object({type:r.z.literal("local_shell_call"),id:r.z.string(),call_id:r.z.string(),action:r.z.object({type:r.z.literal("exec"),command:r.z.array(r.z.string()),timeout_ms:r.z.number().optional(),user:r.z.string().optional(),working_directory:r.z.string().optional(),env:r.z.record(r.z.string(),r.z.string()).optional()})}),r.z.object({type:r.z.literal("function_call"),call_id:r.z.string(),name:r.z.string(),arguments:r.z.string(),id:r.z.string()}),r.z.object({type:r.z.literal("computer_call"),id:r.z.string(),status:r.z.string().optional()}),r.z.object({type:r.z.literal("reasoning"),id:r.z.string(),encrypted_content:r.z.string().nullish(),summary:r.z.array(r.z.object({type:r.z.literal("summary_text"),text:r.z.string()}))})])).optional(),service_tier:r.z.string().nullish(),incomplete_details:r.z.object({reason:r.z.string()}).nullish(),usage:r.z.object({input_tokens:r.z.number(),input_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),output_tokens:r.z.number(),output_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish()}).nullish()}).optional()}))),eo=(0,i.fE)(()=>(0,i.jN)(r.z.object({conversation:r.z.string().nullish(),include:r.z.array(r.z.enum(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:r.z.string().nullish(),logprobs:r.z.union([r.z.boolean(),r.z.number().min(1).max(20)]).optional(),maxToolCalls:r.z.number().nullish(),metadata:r.z.any().nullish(),parallelToolCalls:r.z.boolean().nullish(),previousResponseId:r.z.string().nullish(),promptCacheKey:r.z.string().nullish(),promptCacheRetention:r.z.enum(["in_memory","24h"]).nullish(),reasoningEffort:r.z.string().nullish(),reasoningSummary:r.z.string().nullish(),safetyIdentifier:r.z.string().nullish(),serviceTier:r.z.enum(["auto","flex","priority","default"]).nullish(),store:r.z.boolean().nullish(),strictJsonSchema:r.z.boolean().nullish(),textVerbosity:r.z.enum(["low","medium","high"]).nullish(),truncation:r.z.enum(["auto","disabled"]).nullish(),user:r.z.string().nullish()})));async function er({tools:e,toolChoice:t,strictJsonSchema:n}){e=(null==e?void 0:e.length)?e:void 0;let r=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:r};let l=[];for(let t of e)switch(t.type){case"function":l.push({type:"function",name:t.name,description:t.description,parameters:t.inputSchema,strict:n});break;case"provider-defined":switch(t.id){case"openai.file_search":{let e=await (0,i.k5)({value:t.args,schema:R});l.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case"openai.local_shell":l.push({type:"local_shell"});break;case"openai.web_search_preview":{let e=await (0,i.k5)({value:t.args,schema:B});l.push({type:"web_search_preview",search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.web_search":{let e=await (0,i.k5)({value:t.args,schema:H});l.push({type:"web_search",filters:null!=e.filters?{allowed_domains:e.filters.allowedDomains}:void 0,external_web_access:e.externalWebAccess,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.code_interpreter":{let e=await (0,i.k5)({value:t.args,schema:T});l.push({type:"code_interpreter",container:null==e.container?{type:"auto",file_ids:void 0}:"string"==typeof e.container?e.container:{type:"auto",file_ids:e.container.fileIds}});break}case"openai.image_generation":{let e=await (0,i.k5)({value:t.args,schema:M});l.push({type:"image_generation",background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,size:e.size,quality:e.quality,moderation:e.moderation,output_format:e.outputFormat,output_compression:e.outputCompression})}}break;default:r.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:l,toolChoice:void 0,toolWarnings:r};let s=t.type;switch(s){case"auto":case"none":case"required":return{tools:l,toolChoice:s,toolWarnings:r};case"tool":return{tools:l,toolChoice:"code_interpreter"===t.toolName||"file_search"===t.toolName||"image_generation"===t.toolName||"web_search_preview"===t.toolName||"web_search"===t.toolName?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:r};default:throw new o.b8({functionality:`tool choice type: ${s}`})}}var el=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:o,topK:r,presencePenalty:l,frequencyPenalty:s,seed:u,prompt:p,providerOptions:d,tools:c,toolChoice:m,responseFormat:g}){var h,z,_,y;let f=[],b=a(this.modelId);null!=r&&f.push({type:"unsupported-setting",setting:"topK"}),null!=u&&f.push({type:"unsupported-setting",setting:"seed"}),null!=l&&f.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=s&&f.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=n&&f.push({type:"unsupported-setting",setting:"stopSequences"});let v=await (0,i.xI)({provider:"openai",providerOptions:d,schema:eo});(null==v?void 0:v.conversation)&&(null==v?void 0:v.previousResponseId)&&f.push({type:"unsupported-setting",setting:"conversation",details:"conversation and previousResponseId cannot be used together"});let{input:k,warnings:x}=await X({prompt:p,systemMessageMode:b.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:null==(h=null==v?void 0:v.store)||h,hasLocalShellTool:q("openai.local_shell")});f.push(...x);let j=null!=(z=null==v?void 0:v.strictJsonSchema)&&z,w=null==v?void 0:v.include;function I(e){null==w?w=[e]:w.includes(e)||(w=[...w,e])}function q(e){return(null==c?void 0:c.find(t=>"provider-defined"===t.type&&t.id===e))!=null}let C="number"==typeof(null==v?void 0:v.logprobs)?null==v?void 0:v.logprobs:(null==v?void 0:v.logprobs)===!0?20:void 0;C&&I("message.output_text.logprobs");let N=null==(_=null==c?void 0:c.find(e=>"provider-defined"===e.type&&("openai.web_search"===e.id||"openai.web_search_preview"===e.id)))?void 0:_.name;N&&I("web_search_call.action.sources"),q("openai.code_interpreter")&&I("code_interpreter_call.outputs");let T=null==v?void 0:v.store;!1===T&&b.isReasoningModel&&I("reasoning.encrypted_content");let S={model:this.modelId,input:k,temperature:t,top_p:o,max_output_tokens:e,...((null==g?void 0:g.type)==="json"||(null==v?void 0:v.textVerbosity))&&{text:{...(null==g?void 0:g.type)==="json"&&{format:null!=g.schema?{type:"json_schema",strict:j,name:null!=(y=g.name)?y:"response",description:g.description,schema:g.schema}:{type:"json_object"}},...(null==v?void 0:v.textVerbosity)&&{verbosity:v.textVerbosity}}},conversation:null==v?void 0:v.conversation,max_tool_calls:null==v?void 0:v.maxToolCalls,metadata:null==v?void 0:v.metadata,parallel_tool_calls:null==v?void 0:v.parallelToolCalls,previous_response_id:null==v?void 0:v.previousResponseId,store:T,user:null==v?void 0:v.user,instructions:null==v?void 0:v.instructions,service_tier:null==v?void 0:v.serviceTier,include:w,prompt_cache_key:null==v?void 0:v.promptCacheKey,prompt_cache_retention:null==v?void 0:v.promptCacheRetention,safety_identifier:null==v?void 0:v.safetyIdentifier,top_logprobs:C,truncation:null==v?void 0:v.truncation,...b.isReasoningModel&&((null==v?void 0:v.reasoningEffort)!=null||(null==v?void 0:v.reasoningSummary)!=null)&&{reasoning:{...(null==v?void 0:v.reasoningEffort)!=null&&{effort:v.reasoningEffort},...(null==v?void 0:v.reasoningSummary)!=null&&{summary:v.reasoningSummary}}}};b.isReasoningModel?(null==v?void 0:v.reasoningEffort)==="none"&&b.supportsNonReasoningParameters||(null!=S.temperature&&(S.temperature=void 0,f.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=S.top_p&&(S.top_p=void 0,f.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):((null==v?void 0:v.reasoningEffort)!=null&&f.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),(null==v?void 0:v.reasoningSummary)!=null&&f.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),(null==v?void 0:v.serviceTier)!=="flex"||b.supportsFlexProcessing||(f.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete S.service_tier),(null==v?void 0:v.serviceTier)!=="priority"||b.supportsPriorityProcessing||(f.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete S.service_tier);let{tools:$,toolChoice:E,toolWarnings:R}=await er({tools:c,toolChoice:m,strictJsonSchema:j});return{webSearchToolName:N,args:{...S,tools:$,tool_choice:E},warnings:[...f,...R],store:T}}async doGenerate(e){var t,n,r,l,a,u,p,d,c,m,g,h,z,_,y,f,b,v,k,x,j,w,I,q,C,N,T,S;let{args:$,warnings:E,webSearchToolName:R}=await this.getArgs(e),P=this.config.url({path:"/responses",modelId:this.modelId}),U=this.config.provider.replace(".responses",""),{responseHeaders:M,value:O,rawValue:D}=await (0,i.GU)({url:P,headers:(0,i.m2)(this.config.headers(),e.headers),body:$,failedResponseHandler:s,successfulResponseHandler:(0,i.cV)(ei),abortSignal:e.abortSignal,fetch:this.config.fetch});if(O.error)throw new o.hL({message:O.error.message,url:P,requestBodyValues:$,statusCode:400,responseHeaders:M,responseBody:D,isRetryable:!1});let V=[],A=[],W=!1;for(let o of O.output)switch(o.type){case"reasoning":for(let e of(0===o.summary.length&&o.summary.push({type:"summary_text",text:""}),o.summary))V.push({type:"reasoning",text:e.text,providerMetadata:{[U]:{itemId:o.id,reasoningEncryptedContent:null!=(t=o.encrypted_content)?t:null}}});break;case"image_generation_call":V.push({type:"tool-call",toolCallId:o.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),V.push({type:"tool-result",toolCallId:o.id,toolName:"image_generation",result:{result:o.result},providerExecuted:!0});break;case"local_shell_call":V.push({type:"tool-call",toolCallId:o.call_id,toolName:"local_shell",input:JSON.stringify({action:o.action}),providerMetadata:{[U]:{itemId:o.id}}});break;case"message":for(let t of o.content)for(let s of((null==(r=null==(n=e.providerOptions)?void 0:n.openai)?void 0:r.logprobs)&&t.logprobs&&A.push(t.logprobs),V.push({type:"text",text:t.text,providerMetadata:{[U]:{itemId:o.id}}}),t.annotations))"url_citation"===s.type?V.push({type:"source",sourceType:"url",id:null!=(u=null==(a=(l=this.config).generateId)?void 0:a.call(l))?u:(0,i.$C)(),url:s.url,title:s.title}):"file_citation"===s.type?V.push({type:"source",sourceType:"document",id:null!=(c=null==(d=(p=this.config).generateId)?void 0:d.call(p))?c:(0,i.$C)(),mediaType:"text/plain",title:null!=(g=null!=(m=s.quote)?m:s.filename)?g:"Document",filename:null!=(h=s.filename)?h:s.file_id,...s.file_id?{providerMetadata:{[U]:{fileId:s.file_id}}}:{}}):"container_file_citation"===s.type?V.push({type:"source",sourceType:"document",id:null!=(y=null==(_=(z=this.config).generateId)?void 0:_.call(z))?y:(0,i.$C)(),mediaType:"text/plain",title:null!=(b=null!=(f=s.filename)?f:s.file_id)?b:"Document",filename:null!=(v=s.filename)?v:s.file_id,providerMetadata:{[U]:{fileId:s.file_id,containerId:s.container_id,...null!=s.index?{index:s.index}:{}}}}):"file_path"===s.type&&V.push({type:"source",sourceType:"document",id:null!=(j=null==(x=(k=this.config).generateId)?void 0:x.call(k))?j:(0,i.$C)(),mediaType:"application/octet-stream",title:s.file_id,filename:s.file_id,providerMetadata:{[U]:{fileId:s.file_id,...null!=s.index?{index:s.index}:{}}}});break;case"function_call":W=!0,V.push({type:"tool-call",toolCallId:o.call_id,toolName:o.name,input:o.arguments,providerMetadata:{[U]:{itemId:o.id}}});break;case"web_search_call":V.push({type:"tool-call",toolCallId:o.id,toolName:null!=R?R:"web_search",input:JSON.stringify({}),providerExecuted:!0}),V.push({type:"tool-result",toolCallId:o.id,toolName:null!=R?R:"web_search",result:ea(o.action),providerExecuted:!0});break;case"computer_call":V.push({type:"tool-call",toolCallId:o.id,toolName:"computer_use",input:"",providerExecuted:!0}),V.push({type:"tool-result",toolCallId:o.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:o.status||"completed"},providerExecuted:!0});break;case"file_search_call":V.push({type:"tool-call",toolCallId:o.id,toolName:"file_search",input:"{}",providerExecuted:!0}),V.push({type:"tool-result",toolCallId:o.id,toolName:"file_search",result:{queries:o.queries,results:null!=(I=null==(w=o.results)?void 0:w.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?I:null},providerExecuted:!0});break;case"code_interpreter_call":V.push({type:"tool-call",toolCallId:o.id,toolName:"code_interpreter",input:JSON.stringify({code:o.code,containerId:o.container_id}),providerExecuted:!0}),V.push({type:"tool-result",toolCallId:o.id,toolName:"code_interpreter",result:{outputs:o.outputs},providerExecuted:!0})}let J={[U]:{...null!=O.id?{responseId:O.id}:{}}};A.length>0&&(J[U].logprobs=A),"string"==typeof O.service_tier&&(J[U].serviceTier=O.service_tier);let H=O.usage;return{content:V,finishReason:et({finishReason:null==(q=O.incomplete_details)?void 0:q.reason,hasFunctionCall:W}),usage:{inputTokens:H.input_tokens,outputTokens:H.output_tokens,totalTokens:H.input_tokens+H.output_tokens,reasoningTokens:null!=(N=null==(C=H.output_tokens_details)?void 0:C.reasoning_tokens)?N:void 0,cachedInputTokens:null!=(S=null==(T=H.input_tokens_details)?void 0:T.cached_tokens)?S:void 0},request:{body:$},response:{id:O.id,timestamp:new Date(1e3*O.created_at),modelId:O.model,headers:M,body:D},providerMetadata:J,warnings:E}}async doStream(e){let t,{args:n,warnings:o,webSearchToolName:r,store:l}=await this.getArgs(e),{responseHeaders:a,value:u}=await (0,i.GU)({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),body:{...n,stream:!0},failedResponseHandler:s,successfulResponseHandler:(0,i.Ds)(en),abortSignal:e.abortSignal,fetch:this.config.fetch}),p=this,d=this.config.provider.replace(".responses",""),c="unknown",m={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},g=[],h=null,z={},_=[],y=!1,f={};return{stream:u.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(n,o){var s,a,u,b,v,k,x,j,w,I,q,C,N,T,S,$,E,R,P,U,M,O,D;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:n.rawValue}),!n.success){c="error",o.enqueue({type:"error",error:n.error});return}let V=n.value;if(es(V))"function_call"===V.item.type?(z[V.output_index]={toolName:V.item.name,toolCallId:V.item.call_id},o.enqueue({type:"tool-input-start",id:V.item.call_id,toolName:V.item.name})):"web_search_call"===V.item.type?(z[V.output_index]={toolName:null!=r?r:"web_search",toolCallId:V.item.id},o.enqueue({type:"tool-input-start",id:V.item.id,toolName:null!=r?r:"web_search",providerExecuted:!0}),o.enqueue({type:"tool-input-end",id:V.item.id}),o.enqueue({type:"tool-call",toolCallId:V.item.id,toolName:null!=r?r:"web_search",input:JSON.stringify({}),providerExecuted:!0})):"computer_call"===V.item.type?(z[V.output_index]={toolName:"computer_use",toolCallId:V.item.id},o.enqueue({type:"tool-input-start",id:V.item.id,toolName:"computer_use",providerExecuted:!0})):"code_interpreter_call"===V.item.type?(z[V.output_index]={toolName:"code_interpreter",toolCallId:V.item.id,codeInterpreter:{containerId:V.item.container_id}},o.enqueue({type:"tool-input-start",id:V.item.id,toolName:"code_interpreter",providerExecuted:!0}),o.enqueue({type:"tool-input-delta",id:V.item.id,delta:`{"containerId":"${V.item.container_id}","code":"`})):"file_search_call"===V.item.type?o.enqueue({type:"tool-call",toolCallId:V.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):"image_generation_call"===V.item.type?o.enqueue({type:"tool-call",toolCallId:V.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):"message"===V.item.type?(_.splice(0,_.length),o.enqueue({type:"text-start",id:V.item.id,providerMetadata:{[d]:{itemId:V.item.id}}})):es(V)&&"reasoning"===V.item.type&&(f[V.item.id]={encryptedContent:V.item.encrypted_content,summaryParts:{0:"active"}},o.enqueue({type:"reasoning-start",id:`${V.item.id}:0`,providerMetadata:{[d]:{itemId:V.item.id,reasoningEncryptedContent:null!=(s=V.item.encrypted_content)?s:null}}}));else if("response.output_item.done"===V.type){if("message"===V.item.type)o.enqueue({type:"text-end",id:V.item.id,providerMetadata:{[d]:{itemId:V.item.id,..._.length>0&&{annotations:_}}}});else if("function_call"===V.item.type)z[V.output_index]=void 0,y=!0,o.enqueue({type:"tool-input-end",id:V.item.call_id}),o.enqueue({type:"tool-call",toolCallId:V.item.call_id,toolName:V.item.name,input:V.item.arguments,providerMetadata:{[d]:{itemId:V.item.id}}});else if("web_search_call"===V.item.type)z[V.output_index]=void 0,o.enqueue({type:"tool-result",toolCallId:V.item.id,toolName:null!=r?r:"web_search",result:ea(V.item.action),providerExecuted:!0});else if("computer_call"===V.item.type)z[V.output_index]=void 0,o.enqueue({type:"tool-input-end",id:V.item.id}),o.enqueue({type:"tool-call",toolCallId:V.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),o.enqueue({type:"tool-result",toolCallId:V.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:V.item.status||"completed"},providerExecuted:!0});else if("file_search_call"===V.item.type)z[V.output_index]=void 0,o.enqueue({type:"tool-result",toolCallId:V.item.id,toolName:"file_search",result:{queries:V.item.queries,results:null!=(u=null==(a=V.item.results)?void 0:a.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?u:null},providerExecuted:!0});else if("code_interpreter_call"===V.item.type)z[V.output_index]=void 0,o.enqueue({type:"tool-result",toolCallId:V.item.id,toolName:"code_interpreter",result:{outputs:V.item.outputs},providerExecuted:!0});else if("image_generation_call"===V.item.type)o.enqueue({type:"tool-result",toolCallId:V.item.id,toolName:"image_generation",result:{result:V.item.result},providerExecuted:!0});else if("local_shell_call"===V.item.type)z[V.output_index]=void 0,o.enqueue({type:"tool-call",toolCallId:V.item.call_id,toolName:"local_shell",input:JSON.stringify({action:{type:"exec",command:V.item.action.command,timeoutMs:V.item.action.timeout_ms,user:V.item.action.user,workingDirectory:V.item.action.working_directory,env:V.item.action.env}}),providerMetadata:{[d]:{itemId:V.item.id}}});else if("reasoning"===V.item.type){for(let e of Object.entries(f[V.item.id].summaryParts).filter(([e,t])=>"active"===t||"can-conclude"===t).map(([e])=>e))o.enqueue({type:"reasoning-end",id:`${V.item.id}:${e}`,providerMetadata:{[d]:{itemId:V.item.id,reasoningEncryptedContent:null!=(b=V.item.encrypted_content)?b:null}}});delete f[V.item.id]}}else if("response.function_call_arguments.delta"===V.type){let e=z[V.output_index];null!=e&&o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:V.delta})}else if("response.code_interpreter_call_code.delta"===V.type){let e=z[V.output_index];null!=e&&o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:JSON.stringify(V.delta).slice(1,-1)})}else if("response.code_interpreter_call_code.done"===V.type){let e=z[V.output_index];null!=e&&(o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:'"}'}),o.enqueue({type:"tool-input-end",id:e.toolCallId}),o.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:"code_interpreter",input:JSON.stringify({code:V.code,containerId:e.codeInterpreter.containerId}),providerExecuted:!0}))}else if("response.created"===V.type)h=V.response.id,o.enqueue({type:"response-metadata",id:V.response.id,timestamp:new Date(1e3*V.response.created_at),modelId:V.response.model});else if("response.output_text.delta"===V.type)o.enqueue({type:"text-delta",id:V.item_id,delta:V.delta}),(null==(k=null==(v=e.providerOptions)?void 0:v.openai)?void 0:k.logprobs)&&V.logprobs&&g.push(V.logprobs);else if("response.reasoning_summary_part.added"===V.type){if(V.summary_index>0){let e=f[V.item_id];for(let t of(e.summaryParts[V.summary_index]="active",Object.keys(e.summaryParts)))"can-conclude"===e.summaryParts[t]&&(o.enqueue({type:"reasoning-end",id:`${V.item_id}:${t}`,providerMetadata:{[d]:{itemId:V.item_id}}}),e.summaryParts[t]="concluded");o.enqueue({type:"reasoning-start",id:`${V.item_id}:${V.summary_index}`,providerMetadata:{[d]:{itemId:V.item_id,reasoningEncryptedContent:null!=(j=null==(x=f[V.item_id])?void 0:x.encryptedContent)?j:null}}})}}else{"response.reasoning_summary_text.delta"===V.type?o.enqueue({type:"reasoning-delta",id:`${V.item_id}:${V.summary_index}`,delta:V.delta,providerMetadata:{[d]:{itemId:V.item_id}}}):"response.reasoning_summary_part.done"===V.type?l?(o.enqueue({type:"reasoning-end",id:`${V.item_id}:${V.summary_index}`,providerMetadata:{[d]:{itemId:V.item_id}}}),f[V.item_id].summaryParts[V.summary_index]="concluded"):f[V.item_id].summaryParts[V.summary_index]="can-conclude":"response.completed"===(D=V).type||"response.incomplete"===D.type?(c=et({finishReason:null==(w=V.response.incomplete_details)?void 0:w.reason,hasFunctionCall:y}),m.inputTokens=V.response.usage.input_tokens,m.outputTokens=V.response.usage.output_tokens,m.totalTokens=V.response.usage.input_tokens+V.response.usage.output_tokens,m.reasoningTokens=null!=(q=null==(I=V.response.usage.output_tokens_details)?void 0:I.reasoning_tokens)?q:void 0,m.cachedInputTokens=null!=(N=null==(C=V.response.usage.input_tokens_details)?void 0:C.cached_tokens)?N:void 0,"string"==typeof V.response.service_tier&&(t=V.response.service_tier)):"response.output_text.annotation.added"===V.type?(_.push(V.annotation),"url_citation"===V.annotation.type?o.enqueue({type:"source",sourceType:"url",id:null!=($=null==(S=(T=p.config).generateId)?void 0:S.call(T))?$:(0,i.$C)(),url:V.annotation.url,title:V.annotation.title}):"file_citation"===V.annotation.type&&o.enqueue({type:"source",sourceType:"document",id:null!=(P=null==(R=(E=p.config).generateId)?void 0:R.call(E))?P:(0,i.$C)(),mediaType:"text/plain",title:null!=(M=null!=(U=V.annotation.quote)?U:V.annotation.filename)?M:"Document",filename:null!=(O=V.annotation.filename)?O:V.annotation.file_id,...V.annotation.file_id?{providerMetadata:{[d]:{fileId:V.annotation.file_id}}}:{}})):"error"===V.type&&o.enqueue({type:"error",error:V})}},flush(e){let n={[d]:{responseId:h}};g.length>0&&(n[d].logprobs=g),void 0!==t&&(n[d].serviceTier=t),e.enqueue({type:"finish",finishReason:c,usage:m,providerMetadata:n})}})),request:{body:n},response:{headers:a}}}};function es(e){return"response.output_item.added"===e.type}function ea(e){var t;switch(e.type){case"search":return{action:{type:"search",query:null!=(t=e.query)?t:void 0},...null!=e.sources&&{sources:e.sources}};case"open_page":return{action:{type:"openPage",url:e.url}};case"find_in_page":return{action:{type:"findInPage",url:e.url,pattern:e.pattern}}}}var eu=(0,i.fE)(()=>(0,i.jN)(r.z.object({instructions:r.z.string().nullish(),speed:r.z.number().min(.25).max(4).default(1).nullish()}))),ep=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:o,instructions:r,language:l,providerOptions:s}){let a=[],u=await (0,i.xI)({provider:"openai",providerOptions:s,schema:eu}),p={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:o,instructions:r};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?p.response_format=n:a.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),u){let e={};for(let t in e){let n=e[t];void 0!==n&&(p[t]=n)}}return l&&a.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${l}" was ignored.`}),{requestBody:p,warnings:a}}async doGenerate(e){var t,n,o;let r=null!=(o=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?o:new Date,{requestBody:l,warnings:a}=await this.getArgs(e),{value:u,responseHeaders:p,rawValue:d}=await (0,i.GU)({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),body:l,failedResponseHandler:s,successfulResponseHandler:(0,i.HD)(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:u,warnings:a,request:{body:JSON.stringify(l)},response:{timestamp:r,modelId:this.modelId,headers:p,body:d}}}},ed=(0,i.fE)(()=>(0,i.jN)(r.z.object({text:r.z.string(),language:r.z.string().nullish(),duration:r.z.number().nullish(),words:r.z.array(r.z.object({word:r.z.string(),start:r.z.number(),end:r.z.number()})).nullish(),segments:r.z.array(r.z.object({id:r.z.number(),seek:r.z.number(),start:r.z.number(),end:r.z.number(),text:r.z.string(),tokens:r.z.array(r.z.number()),temperature:r.z.number(),avg_logprob:r.z.number(),compression_ratio:r.z.number(),no_speech_prob:r.z.number()})).nullish()}))),ec=(0,i.fE)(()=>(0,i.jN)(r.z.object({include:r.z.array(r.z.string()).optional(),language:r.z.string().optional(),prompt:r.z.string().optional(),temperature:r.z.number().min(0).max(1).default(0).optional(),timestampGranularities:r.z.array(r.z.enum(["word","segment"])).default(["segment"]).optional()}))),em={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},eg=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let o=await (0,i.xI)({provider:"openai",providerOptions:n,schema:ec}),r=new FormData,l=e instanceof Uint8Array?new Blob([e]):new Blob([(0,i.Z9)(e)]);r.append("model",this.modelId);let s=(0,i.HQ)(t);if(r.append("file",new File([l],"audio",{type:t}),`audio.${s}`),o){for(let[e,t]of Object.entries({include:o.include,language:o.language,prompt:o.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:o.temperature,timestamp_granularities:o.timestampGranularities}))if(null!=t)if(Array.isArray(t))for(let n of t)r.append(`${e}[]`,String(n));else r.append(e,String(t))}return{formData:r,warnings:[]}}async doGenerate(e){var t,n,o,r,l,a,u,p;let d=null!=(o=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?o:new Date,{formData:c,warnings:m}=await this.getArgs(e),{value:g,responseHeaders:h,rawValue:z}=await (0,i.S)({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:(0,i.m2)(this.config.headers(),e.headers),formData:c,failedResponseHandler:s,successfulResponseHandler:(0,i.cV)(ed),abortSignal:e.abortSignal,fetch:this.config.fetch}),_=null!=g.language&&g.language in em?em[g.language]:void 0;return{text:g.text,segments:null!=(u=null!=(a=null==(r=g.segments)?void 0:r.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))?a:null==(l=g.words)?void 0:l.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?u:[],language:_,durationInSeconds:null!=(p=g.duration)?p:void 0,warnings:m,response:{timestamp:d,modelId:this.modelId,headers:h,body:z}}}};function eh(e={}){var t,n;let o=null!=(t=(0,i.ae)((0,i.x3)({settingValue:e.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))?t:"https://api.openai.com/v1",r=null!=(n=e.name)?n:"openai",l=()=>(0,i.WZ)({Authorization:`Bearer ${(0,i.WL)({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},"ai-sdk/openai/2.0.89"),s=t=>new x(t,{provider:`${r}.embedding`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),a=t=>new q(t,{provider:`${r}.image`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),u=t=>new eg(t,{provider:`${r}.transcription`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),p=t=>new ep(t,{provider:`${r}.speech`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),d=e=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return c(e)},c=t=>new el(t,{provider:`${r}.responses`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch,fileIdPrefixes:["file-"]}),m=function(e){return d(e)};return m.languageModel=d,m.chat=t=>new g(t,{provider:`${r}.chat`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),m.completion=t=>new b(t,{provider:`${r}.completion`,url:({path:e})=>`${o}${e}`,headers:l,fetch:e.fetch}),m.responses=c,m.embedding=s,m.textEmbedding=s,m.textEmbeddingModel=s,m.image=a,m.imageModel=a,m.transcription=u,m.transcriptionModel=u,m.speech=p,m.speechModel=p,m.tools=Q,m}eh()}}]);