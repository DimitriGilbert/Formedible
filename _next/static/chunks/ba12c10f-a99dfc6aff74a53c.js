"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{58950:(e,t,a)=>{a.d(t,{gM:()=>tU});var r,o,n,s,i,l,u,p,d,c,m,h,f,g,y,v=a(82267),b=a(55337),z=a(49212),I=a(31296),w=a(83794),T=a(39530),x=Object.defineProperty,E="AI_NoOutputSpecifiedError",S=`vercel.ai.error.${E}`,k=Symbol.for(S),C=class extends b.bD{constructor({message:e="No output specified."}={}){super({name:E,message:e}),this[r]=!0}static isInstance(e){return b.bD.hasMarker(e,S)}};r=k;var M=!1,N=e=>{if(0===e.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t)return void t(e);for(let t of(M||(M=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e))console.warn(function(e){let t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let a=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(a+=` - ${e.details}`),a}case"unsupported-tool":{let a="name"in e.tool?e.tool.name:"unknown tool",r=`${t} The tool "${a}" is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}(t))}},R="AI_InvalidArgumentError",_=`vercel.ai.error.${R}`,O=Symbol.for(_),j=class extends b.bD{constructor({parameter:e,value:t,message:a}){super({name:R,message:`Invalid argument for parameter ${e}: ${a}`}),this[o]=!0,this.parameter=e,this.value=t}static isInstance(e){return b.bD.hasMarker(e,_)}};o=O;var A=Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");b.bD;var D="AI_InvalidToolInputError",q=`vercel.ai.error.${D}`,P=Symbol.for(q),$=class extends b.bD{constructor({toolInput:e,toolName:t,cause:a,message:r=`Invalid input for tool ${t}: ${(0,b.u1)(a)}`}){super({name:D,message:r,cause:a}),this[n]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return b.bD.hasMarker(e,q)}};n=P;var U="vercel.ai.error.AI_MCPClientError",F=Symbol.for(U),J=class extends b.bD{constructor({name:e="MCPClientError",message:t,cause:a,data:r,code:o}){super({name:e,message:t,cause:a}),this[s]=!0,this.data=r,this.code=o}static isInstance(e){return b.bD.hasMarker(e,U)}};s=F;var L="AI_NoImageGeneratedError",B=`vercel.ai.error.${L}`,V=Symbol.for(B);b.bD,i=V;var W="AI_NoObjectGeneratedError",G=`vercel.ai.error.${W}`,K=Symbol.for(G),Y=class extends b.bD{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:o,finishReason:n}){super({name:W,message:e,cause:t}),this[l]=!0,this.text=a,this.response=r,this.usage=o,this.finishReason=n}static isInstance(e){return b.bD.hasMarker(e,G)}};l=K;var Z="AI_NoOutputGeneratedError",H=`vercel.ai.error.${Z}`,Q=Symbol.for(H),X=class extends b.bD{constructor({message:e="No output generated.",cause:t}={}){super({name:Z,message:e,cause:t}),this[u]=!0}static isInstance(e){return b.bD.hasMarker(e,H)}};u=Q,b.bD;var ee="AI_NoSuchToolError",et=`vercel.ai.error.${ee}`,ea=Symbol.for(et),er=class extends b.bD{constructor({toolName:e,availableTools:t,message:a=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:ee,message:a}),this[p]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return b.bD.hasMarker(e,et)}};p=ea;var eo="AI_ToolCallRepairError",en=`vercel.ai.error.${eo}`,es=Symbol.for(en),ei=class extends b.bD{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${(0,b.u1)(e)}`}){super({name:eo,message:a,cause:e}),this[d]=!0,this.originalError=t}static isInstance(e){return b.bD.hasMarker(e,en)}};d=es;var el=class extends b.bD{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},eu="AI_InvalidDataContentError",ep=`vercel.ai.error.${eu}`,ed=Symbol.for(ep);b.bD,c=ed;var ec="AI_InvalidMessageRoleError",em=`vercel.ai.error.${ec}`,eh=Symbol.for(em),ef=class extends b.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ec,message:t}),this[m]=!0,this.role=e}static isInstance(e){return b.bD.hasMarker(e,em)}};m=eh;var eg="AI_MessageConversionError",ey=`vercel.ai.error.${eg}`,ev=Symbol.for(ey);b.bD,h=ev;var eb="AI_DownloadError",ez=`vercel.ai.error.${eb}`,eI=Symbol.for(ez),ew=class extends b.bD{constructor({url:e,statusCode:t,statusText:a,cause:r,message:o=null==r?`Failed to download ${e}: ${t} ${a}`:`Failed to download ${e}: ${r}`}){super({name:eb,message:o,cause:r}),this[f]=!0,this.url=e,this.statusCode=t,this.statusText=a}static isInstance(e){return b.bD.hasMarker(e,ez)}};f=eI;var eT="AI_RetryError",ex=`vercel.ai.error.${eT}`,eE=Symbol.for(ex),eS=class extends b.bD{constructor({message:e,reason:t,errors:a}){super({name:eT,message:e}),this[g]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return b.bD.hasMarker(e,ex)}};function ek(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new el({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return eC().languageModel(e)}function eC(){var e;return null!=(e=globalThis.AI_SDK_DEFAULT_PROVIDER)?e:z.JS}g=eE;var eM=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],eN=e=>{let t="string"==typeof e?(0,v.Z9)(e):e,a=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(a+10)},eR="5.0.76",e_=async({url:e})=>{var t;let a=e.toString();try{let e=await fetch(a,{headers:(0,v.WZ)({},`ai-sdk/${eR}`,(0,v.G1)())});if(!e.ok)throw new ew({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(ew.isInstance(e))throw e;throw new ew({url:a,cause:e})}},eO=(e=e_)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))),ej=I.z.union([I.z.string(),I.z.instanceof(Uint8Array),I.z.instanceof(ArrayBuffer),I.z.custom(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]);function eA(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:a}=function(e){try{let[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==a)throw new b.bD({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}async function eD({prompt:e,supportedUrls:t,download:a=eO()}){let r=await eq(e.messages,a,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let a=e.role;switch(a){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var a;let r;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let o=e.type;switch(o){case"image":r=e.image;break;case"file":r=e.data;break;default:throw Error(`Unsupported part type: ${o}`)}let{data:n,mediaType:s}=eA(r),i=null!=s?s:e.mediaType,l=n;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=i||(i=e.mediaType))}switch(o){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(i=null!=(a=function({data:e,signatures:t}){let a="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?eN(e):e,r="string"==typeof a?(0,v.Z9)(a.substring(0,Math.min(a.length,24))):a;for(let e of t)if(r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>null===e||r[t]===e))return e.mediaType}({data:l,signatures:eM}))?a:i),{type:"file",mediaType:null!=i?i:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==i)throw Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text||null!=e.providerOptions).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:a,mediaType:r}=eA(e.data);return{type:"file",data:a,filename:e.filename,mediaType:null!=r?r:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new ef({role:a})}})({message:e,downloadedAssets:r}))]}async function eq(e,t,a){let r=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let a=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,r="image"===e.type?e.image:e.data;if("string"==typeof r)try{r=new URL(r)}catch(e){}return{mediaType:a,data:r}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&(0,v.qs)({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:a})}));return Object.fromEntries((await t(r)).map((e,t)=>null==e?null:[r[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>null!=e))}function eP({maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:o,frequencyPenalty:n,seed:s,stopSequences:i}){if(null!=e){if(!Number.isInteger(e))throw new j({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new j({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new j({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=a&&"number"!=typeof a)throw new j({parameter:"topP",value:a,message:"topP must be a number"});if(null!=r&&"number"!=typeof r)throw new j({parameter:"topK",value:r,message:"topK must be a number"});if(null!=o&&"number"!=typeof o)throw new j({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new j({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=s&&!Number.isInteger(s))throw new j({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:o,frequencyPenalty:n,stopSequences:i,seed:s}}function e$({tools:e,toolChoice:t,activeTools:a}){return null!=e&&Object.keys(e).length>0?{tools:(null!=a?Object.entries(e).filter(([e])=>a.includes(e)):Object.entries(e)).map(([e,t])=>{let a=t.type;switch(a){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:(0,v.mD)(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${a}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var eU=I.z.lazy(()=>I.z.union([I.z.null(),I.z.string(),I.z.number(),I.z.boolean(),I.z.record(I.z.string(),eU),I.z.array(eU)])),eF=I.z.record(I.z.string(),I.z.record(I.z.string(),eU)),eJ=I.z.object({type:I.z.literal("text"),text:I.z.string(),providerOptions:eF.optional()}),eL=I.z.object({type:I.z.literal("image"),image:I.z.union([ej,I.z.instanceof(URL)]),mediaType:I.z.string().optional(),providerOptions:eF.optional()}),eB=I.z.object({type:I.z.literal("file"),data:I.z.union([ej,I.z.instanceof(URL)]),filename:I.z.string().optional(),mediaType:I.z.string(),providerOptions:eF.optional()}),eV=I.z.object({type:I.z.literal("reasoning"),text:I.z.string(),providerOptions:eF.optional()}),eW=I.z.object({type:I.z.literal("tool-call"),toolCallId:I.z.string(),toolName:I.z.string(),input:I.z.unknown(),providerOptions:eF.optional(),providerExecuted:I.z.boolean().optional()}),eG=I.z.discriminatedUnion("type",[I.z.object({type:I.z.literal("text"),value:I.z.string()}),I.z.object({type:I.z.literal("json"),value:eU}),I.z.object({type:I.z.literal("error-text"),value:I.z.string()}),I.z.object({type:I.z.literal("error-json"),value:eU}),I.z.object({type:I.z.literal("content"),value:I.z.array(I.z.union([I.z.object({type:I.z.literal("text"),text:I.z.string()}),I.z.object({type:I.z.literal("media"),data:I.z.string(),mediaType:I.z.string()})]))})]),eK=I.z.object({type:I.z.literal("tool-result"),toolCallId:I.z.string(),toolName:I.z.string(),output:eG,providerOptions:eF.optional()}),eY=I.z.object({role:I.z.literal("system"),content:I.z.string(),providerOptions:eF.optional()}),eZ=I.z.object({role:I.z.literal("user"),content:I.z.union([I.z.string(),I.z.array(I.z.union([eJ,eL,eB]))]),providerOptions:eF.optional()}),eH=I.z.object({role:I.z.literal("assistant"),content:I.z.union([I.z.string(),I.z.array(I.z.union([eJ,eB,eV,eW,eK]))]),providerOptions:eF.optional()}),eQ=I.z.object({role:I.z.literal("tool"),content:I.z.array(eK),providerOptions:eF.optional()}),eX=I.z.union([eY,eZ,eH,eQ]);async function e0(e){let t;if(null==e.prompt&&null==e.messages)throw new b.M3({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new b.M3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new b.M3({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new b.M3({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new b.M3({prompt:e,message:"messages must not be empty"});let a=await (0,v.ZZ)({value:t,schema:I.z.array(eX)});if(!a.success)throw new b.M3({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:a.error});return{messages:t,system:e.system}}function e1(e){return z.jN.isInstance(e)||z.vj.isInstance(e)?new b.bD({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function e2({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function e8({model:e,settings:t,telemetry:a,headers:r}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,a])=>(e[`ai.settings.${t}`]=a,e),{}),...Object.entries(null!=(o=null==a?void 0:a.metadata)?o:{}).reduce((e,[t,a])=>(e[`ai.telemetry.metadata.${t}`]=a,e),{}),...Object.entries(null!=r?r:{}).reduce((e,[t,a])=>(void 0!==a&&(e[`ai.request.headers.${t}`]=a),e),{})}}var e7={startSpan:()=>e3,startActiveSpan:(e,t,a,r)=>"function"==typeof t?t(e3):"function"==typeof a?a(e3):"function"==typeof r?r(e3):void 0},e3={spanContext:()=>e6,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},e6={traceId:"",spanId:"",traceFlags:0};function e4({isEnabled:e=!1,tracer:t}={}){return e?t||w.u.getTracer("ai"):e7}function e5({name:e,tracer:t,attributes:a,fn:r,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:a},async e=>{try{let t=await r(e);return o&&e.end(),t}catch(t){try{e9(e,t)}finally{e.end()}throw t}})}function e9(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:T.s.ERROR,message:t.message})):e.setStatus({code:T.s.ERROR})}function te({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[a,r])=>{if(null==r)return t;if("object"==typeof r&&"input"in r&&"function"==typeof r.input){if((null==e?void 0:e.recordInputs)===!1)return t;let o=r.input();return null==o?t:{...t,[a]:o}}if("object"==typeof r&&"output"in r&&"function"==typeof r.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let o=r.output();return null==o?t:{...t,[a]:o}}return{...t,[a]:r}},{})}function tt(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?(0,v.n_)(new Uint8Array(t)):(0,v.n_)(t):e.data}:e})})))}function ta(e,t){return{inputTokens:tr(e.inputTokens,t.inputTokens),outputTokens:tr(e.outputTokens,t.outputTokens),totalTokens:tr(e.totalTokens,t.totalTokens),reasoningTokens:tr(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:tr(e.cachedInputTokens,t.cachedInputTokens)}}function tr(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function to(e){return void 0===e?[]:Array.isArray(e)?e:[e]}var tn=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2,abortSignal:r}={})=>async o=>ts(o,{maxRetries:e,delayInMs:t,backoffFactor:a,abortSignal:r});async function ts(e,{maxRetries:t,delayInMs:a,backoffFactor:r,abortSignal:o},n=[]){try{return await e()}catch(u){if((0,v.zf)(u)||0===t)throw u;let s=(0,v.u1)(u),i=[...n,u],l=i.length;if(l>t)throw new eS({message:`Failed after ${l} attempts. Last error: ${s}`,reason:"maxRetriesExceeded",errors:i});if(u instanceof Error&&b.hL.isInstance(u)&&!0===u.isRetryable&&l<=t)return await (0,v.cb)(function({error:e,exponentialBackoffDelay:t}){let a,r=e.responseHeaders;if(!r)return t;let o=r["retry-after-ms"];if(o){let e=parseFloat(o);Number.isNaN(e)||(a=e)}let n=r["retry-after"];if(n&&void 0===a){let e=parseFloat(n);a=Number.isNaN(e)?Date.parse(n)-Date.now():1e3*e}return null!=a&&!Number.isNaN(a)&&0<=a&&(a<6e4||a<t)?a:t}({error:u,exponentialBackoffDelay:a}),{abortSignal:o}),ts(e,{maxRetries:t,delayInMs:r*a,backoffFactor:r,abortSignal:o},i);if(1===l)throw u;throw new eS({message:`Failed after ${l} attempts with non-retryable error: '${s}'`,reason:"errorNotRetryable",errors:i})}}function ti({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new j({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new j({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let a=null!=e?e:2;return{maxRetries:a,retry:tn({maxRetries:a,abortSignal:t})}}function tl(e){let t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var tu=class{constructor({data:e,mediaType:t}){let a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,v.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,v.Z9)(this.base64Data)),this.uint8ArrayData}},tp=class extends tu{constructor(e){super(e),this.type="file"}};async function td({toolCall:e,tools:t,repairToolCall:a,system:r,messages:o}){try{if(null==t)throw new er({toolName:e.toolName});try{return await tc({toolCall:e,tools:t})}catch(s){if(null==a||!(er.isInstance(s)||$.isInstance(s)))throw s;let n=null;try{n=await a({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:a}=t[e];return(0,v.mD)(a).jsonSchema},system:r,messages:o,error:s})}catch(e){throw new ei({cause:e,originalError:s})}if(null==n)throw s;return await tc({toolCall:n,tools:t})}}catch(r){let t=await (0,v.N8)({text:e.input}),a=t.success?t.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:a,dynamic:!0,invalid:!0,error:r}}}async function tc({toolCall:e,tools:t}){let a=e.toolName,r=t[a];if(null==r)throw new er({toolName:e.toolName,availableTools:Object.keys(t)});let o=(0,v.mD)(r.inputSchema),n=""===e.input.trim()?await (0,v.ZZ)({value:{},schema:o}):await (0,v.N8)({text:e.input,schema:o});if(!1===n.success)throw new $({toolName:a,toolInput:e.input,cause:n.error});return"dynamic"===r.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var tm=class{constructor({content:e,finishReason:t,usage:a,warnings:r,request:o,response:n,providerMetadata:s}){this.content=e,this.finishReason=t,this.usage=a,this.warnings=r,this.request=o,this.response=n,this.providerMetadata=s}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!0!==e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!0!==e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};function th(e){return({steps:t})=>t.length===e}async function tf({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function tg({output:e,tool:t,errorMode:a}){return"text"===a?{type:"error-text",value:(0,b.u1)(e)}:"json"===a?{type:"error-json",value:ty(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:ty(e)}}function ty(e){return void 0===e?null:e}function tv({content:e,tools:t}){let a=[],r=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tg({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tg({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});r.length>0&&a.push({role:"assistant",content:r});let o=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tg({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return o.length>0&&a.push({role:"tool",content:o}),a}var tb=(0,v.hK)({prefix:"aitxt",size:24});async function tz({toolCalls:e,tools:t,tracer:a,telemetry:r,messages:o,abortSignal:n,experimental_context:s}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,input:l})=>{let u=t[i];if((null==u?void 0:u.execute)!=null)return e5({name:"ai.toolCall",attributes:te({telemetry:r,attributes:{...e2({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:a,fn:async t=>{try{let a;for await(let t of executeTool({execute:u.execute.bind(u),input:l,options:{toolCallId:e,messages:o,abortSignal:n,experimental_context:s}}))"final"===t.type&&(a=t.output);try{t.setAttributes(te({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}return{type:"tool-result",toolCallId:e,toolName:i,input:l,output:a,dynamic:"dynamic"===u.type}}catch(a){return e9(t,a),{type:"tool-error",toolCallId:e,toolName:i,input:l,error:a,dynamic:"dynamic"===u.type}}}})}))).filter(e=>null!=e)}var tI=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>ta(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new C;return this.resolvedOutput}};function tw(e){let t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function tT(e,t){let a=new Headers(null!=e?e:{});for(let[e,r]of Object.entries(t))a.has(e)||a.set(e,r);return a}function tx({status:e,statusText:t,headers:a,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:tT(a,{"content-type":"text/plain; charset=utf-8"})})}function tE({response:e,status:t,statusText:a,headers:r,stream:o}){e.writeHead(null!=t?t:200,a,r);let n=o.getReader();(async()=>{try{for(;;){let{done:t,value:a}=await n.read();if(t)break;e.write(a)||await new Promise(t=>{e.once("drain",t)})}}catch(e){throw e}finally{e.end()}})()}function tS({response:e,status:t,statusText:a,headers:r,textStream:o}){tE({response:e,status:t,statusText:a,headers:Object.fromEntries(tT(r,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:o.pipeThrough(new TextEncoderStream)})}var tk=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},tC={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"},tM=(0,v.fE)(()=>(0,v.jN)(I.z.union([I.z.strictObject({type:I.z.literal("text-start"),id:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("text-delta"),id:I.z.string(),delta:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("text-end"),id:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("error"),errorText:I.z.string()}),I.z.strictObject({type:I.z.literal("tool-input-start"),toolCallId:I.z.string(),toolName:I.z.string(),providerExecuted:I.z.boolean().optional(),dynamic:I.z.boolean().optional()}),I.z.strictObject({type:I.z.literal("tool-input-delta"),toolCallId:I.z.string(),inputTextDelta:I.z.string()}),I.z.strictObject({type:I.z.literal("tool-input-available"),toolCallId:I.z.string(),toolName:I.z.string(),input:I.z.unknown(),providerExecuted:I.z.boolean().optional(),providerMetadata:eF.optional(),dynamic:I.z.boolean().optional()}),I.z.strictObject({type:I.z.literal("tool-input-error"),toolCallId:I.z.string(),toolName:I.z.string(),input:I.z.unknown(),providerExecuted:I.z.boolean().optional(),providerMetadata:eF.optional(),dynamic:I.z.boolean().optional(),errorText:I.z.string()}),I.z.strictObject({type:I.z.literal("tool-output-available"),toolCallId:I.z.string(),output:I.z.unknown(),providerExecuted:I.z.boolean().optional(),dynamic:I.z.boolean().optional(),preliminary:I.z.boolean().optional()}),I.z.strictObject({type:I.z.literal("tool-output-error"),toolCallId:I.z.string(),errorText:I.z.string(),providerExecuted:I.z.boolean().optional(),dynamic:I.z.boolean().optional()}),I.z.strictObject({type:I.z.literal("reasoning-start"),id:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("reasoning-delta"),id:I.z.string(),delta:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("reasoning-end"),id:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("source-url"),sourceId:I.z.string(),url:I.z.string(),title:I.z.string().optional(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("source-document"),sourceId:I.z.string(),mediaType:I.z.string(),title:I.z.string(),filename:I.z.string().optional(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.literal("file"),url:I.z.string(),mediaType:I.z.string(),providerMetadata:eF.optional()}),I.z.strictObject({type:I.z.custom(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:I.z.string().optional(),data:I.z.unknown(),transient:I.z.boolean().optional()}),I.z.strictObject({type:I.z.literal("start-step")}),I.z.strictObject({type:I.z.literal("finish-step")}),I.z.strictObject({type:I.z.literal("start"),messageId:I.z.string().optional(),messageMetadata:I.z.unknown().optional()}),I.z.strictObject({type:I.z.literal("finish"),messageMetadata:I.z.unknown().optional()}),I.z.strictObject({type:I.z.literal("abort")}),I.z.strictObject({type:I.z.literal("message-metadata"),messageMetadata:I.z.unknown()})])));async function tN(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,v.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,v.N8)({text:function(e){let t=["ROOT"],a=-1,r=null;function o(e,o,n){switch(e){case'"':a=o,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=o,r=o,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=o,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":a=o,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":a=o,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function s(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let i=0;i<e.length;i++){let l=e[i];switch(t[t.length-1]){case"ROOT":o(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=i}break;case"INSIDE_ARRAY_START":"]"===l?(a=i,t.pop()):(a=i,o(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=i,t.pop();break;default:a=i}break;case"INSIDE_ARRAY_AFTER_COMMA":o(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(r,i+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?a=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(l,i))}}}let i=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function tR(e){return e.type.startsWith("tool-")}function t_(e){return e.type.split("-").slice(1).join("-")}function tO(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function a(a){var r;t=!0;try{a&&await (null==(r=e.cancel)?void 0:r.call(e))}finally{try{e.releaseLock()}catch(e){}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:r,value:o}=await e.read();return r?(await a(!0),{done:!0,value:void 0}):{done:!1,value:o}},return:async()=>(await a(!0),{done:!0,value:void 0}),async throw(e){throw await a(!0),e}}},t}async function tj({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}function tA(){let e,t;return{promise:new Promise((a,r)=>{e=a,t=r}),resolve:e,reject:t}}function tD(){let e=[],t=null,a=!1,r=tA(),o=()=>{a=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},n=async()=>{if(a&&0===e.length){null==t||t.close();return}if(0===e.length)return r=tA(),await r.promise,n();try{let{value:r,done:o}=await e[0].read();o?(e.shift(),e.length>0?await n():a&&(null==t||t.close())):null==t||t.enqueue(r)}catch(a){null==t||t.error(a),e.shift(),o()}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],a=!0}}),addStream:t=>{if(a)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),r.resolve()},close:()=>{a=!0,r.resolve(),0===e.length&&(null==t||t.close())},terminate:o}}var tq=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}};function tP(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}var t$=(0,v.hK)({prefix:"aitxt",size:24});function tU({model:e,tools:t,toolChoice:a,system:r,prompt:o,messages:n,maxRetries:s,abortSignal:i,headers:l,stopWhen:u=th(1),experimental_output:p,experimental_telemetry:d,prepareStep:c,providerOptions:m,experimental_activeTools:h,activeTools:f=h,experimental_repairToolCall:g,experimental_transform:y,experimental_download:v,includeRawChunks:b=!1,onChunk:z,onError:I=({error:e})=>{console.error(e)},onFinish:w,onAbort:T,onStepFinish:x,experimental_context:E,_internal:{now:S=tP,generateId:k=t$,currentDate:C=()=>new Date}={},...M}){return new tF({model:ek(e),telemetry:d,headers:l,settings:M,maxRetries:s,abortSignal:i,system:r,prompt:o,messages:n,tools:t,toolChoice:a,transforms:to(y),activeTools:f,repairToolCall:g,stopConditions:to(u),output:p,providerOptions:m,prepareStep:c,includeRawChunks:b,onChunk:z,onError:I,onFinish:w,onAbort:T,onStepFinish:x,now:S,currentDate:C,generateId:k,experimental_context:E,download:v})}var tF=class{constructor({model:e,telemetry:t,headers:a,settings:r,maxRetries:o,abortSignal:n,system:s,prompt:i,messages:l,tools:u,toolChoice:p,transforms:d,activeTools:c,repairToolCall:m,stopConditions:h,output:f,providerOptions:g,prepareStep:y,includeRawChunks:b,now:z,currentDate:I,generateId:w,onChunk:T,onError:x,onFinish:E,onAbort:S,onStepFinish:k,experimental_context:C,download:M}){let R,_,O,j;this._totalUsage=new tq,this._finishReason=new tq,this._steps=new tq,this.output=f,this.includeRawChunks=b,this.tools=u;let A=[],D=[],q={},P=[],$=[],U={},F={},J=new TransformStream({async transform(e,t){var a,r,o,n;t.enqueue(e);let{part:s}=e;if(("text-delta"===s.type||"reasoning-delta"===s.type||"source"===s.type||"tool-call"===s.type||"tool-result"===s.type||"tool-input-start"===s.type||"tool-input-delta"===s.type||"raw"===s.type)&&await (null==T?void 0:T({chunk:s})),"error"===s.type&&await x({error:e1(s.error)}),"text-start"===s.type&&(U[s.id]={type:"text",text:"",providerMetadata:s.providerMetadata},A.push(U[s.id])),"text-delta"===s.type){let e=U[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`text part ${s.id} not found`},partialOutput:void 0});e.text+=s.text,e.providerMetadata=null!=(a=s.providerMetadata)?a:e.providerMetadata}if("text-end"===s.type){let e=U[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`text part ${s.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(r=s.providerMetadata)?r:e.providerMetadata,delete U[s.id]}if("reasoning-start"===s.type&&(F[s.id]={type:"reasoning",text:"",providerMetadata:s.providerMetadata},A.push(F[s.id])),"reasoning-delta"===s.type){let e=F[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`reasoning part ${s.id} not found`},partialOutput:void 0});e.text+=s.text,e.providerMetadata=null!=(o=s.providerMetadata)?o:e.providerMetadata}if("reasoning-end"===s.type){let e=F[s.id];if(null==e)return void t.enqueue({part:{type:"error",error:`reasoning part ${s.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(n=s.providerMetadata)?n:e.providerMetadata,delete F[s.id]}if("file"===s.type&&A.push({type:"file",file:s.file}),"source"===s.type&&A.push(s),"tool-call"===s.type&&A.push(s),"tool-result"!==s.type||s.preliminary||A.push(s),"tool-error"===s.type&&A.push(s),"start-step"===s.type&&(q=s.request,P=s.warnings),"finish-step"===s.type){let e=tv({content:A,tools:u}),t=new tm({content:A,finishReason:s.finishReason,usage:s.usage,warnings:P,request:q,response:{...s.response,messages:[...D,...e]},providerMetadata:s.providerMetadata});await (null==k?void 0:k(t)),N(P),$.push(t),A=[],F={},U={},D.push(...e),R.resolve()}"finish"===s.type&&(j=s.totalUsage,O=s.finishReason)},async flush(e){try{if(0===$.length){let e=new X({message:"No output generated. Check the stream for errors."});H._finishReason.reject(e),H._totalUsage.reject(e),H._steps.reject(e);return}let e=null!=O?O:"unknown",a=null!=j?j:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};H._finishReason.resolve(e),H._totalUsage.resolve(a),H._steps.resolve($);let r=$[$.length-1];await (null==E?void 0:E({finishReason:e,totalUsage:a,usage:r.usage,content:r.content,text:r.text,reasoningText:r.reasoningText,reasoning:r.reasoning,files:r.files,sources:r.sources,toolCalls:r.toolCalls,staticToolCalls:r.staticToolCalls,dynamicToolCalls:r.dynamicToolCalls,toolResults:r.toolResults,staticToolResults:r.staticToolResults,dynamicToolResults:r.dynamicToolResults,request:r.request,response:r.response,warnings:r.warnings,providerMetadata:r.providerMetadata,steps:$})),_.setAttributes(te({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>r.text},"ai.response.toolCalls":{output:()=>{var e;return(null==(e=r.toolCalls)?void 0:e.length)?JSON.stringify(r.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(r.providerMetadata),"ai.usage.inputTokens":a.inputTokens,"ai.usage.outputTokens":a.outputTokens,"ai.usage.totalTokens":a.totalTokens,"ai.usage.reasoningTokens":a.reasoningTokens,"ai.usage.cachedInputTokens":a.cachedInputTokens}}))}catch(t){e.error(t)}finally{_.end()}}}),L=tD();this.addStream=L.addStream,this.closeStream=L.close;let B=L.stream.getReader(),V=new ReadableStream({async start(e){e.enqueue({type:"start"})},async pull(e){function t(){null==S||S({steps:$}),e.enqueue({type:"abort"}),e.close()}try{let{done:a,value:r}=await B.read();if(a)return void e.close();if(null==n?void 0:n.aborted)return void t();e.enqueue(r)}catch(a){(0,v.zf)(a)&&(null==n?void 0:n.aborted)?t():e.error(a)}},cancel:e=>L.stream.cancel(e)});for(let e of d)V=V.pipeThrough(e({tools:u,stopStream(){L.terminate()}}));this.baseStream=V.pipeThrough(function(e){let t;if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let a="",r="",o="";function n({controller:e,partialOutput:a}){e.enqueue({part:{type:"text-delta",id:t,text:r},partialOutput:a}),r=""}return new TransformStream({async transform(s,i){if("finish-step"===s.type&&r.length>0&&n({controller:i}),"text-delta"!==s.type&&"text-start"!==s.type&&"text-end"!==s.type)return void i.enqueue({part:s,partialOutput:void 0});if(null==t)t=s.id;else if(s.id!==t)return void i.enqueue({part:s,partialOutput:void 0});if("text-start"===s.type)return void i.enqueue({part:s,partialOutput:void 0});if("text-end"===s.type){r.length>0&&n({controller:i}),i.enqueue({part:s,partialOutput:void 0});return}a+=s.text,r+=s.text;let l=await e.parsePartial({text:a});if(null!=l){let e=JSON.stringify(l.partial);e!==o&&(n({controller:i,partialOutput:l.partial}),o=e)}}})}(f)).pipeThrough(J);let{maxRetries:W,retry:G}=ti({maxRetries:o,abortSignal:n}),K=e4(t),Y=eP(r),Z=e8({model:e,telemetry:t,headers:a,settings:{...Y,maxRetries:W}}),H=this;e5({name:"ai.streamText",attributes:te({telemetry:t,attributes:{...e2({operationId:"ai.streamText",telemetry:t}),...Z,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:i,messages:l})}}}),tracer:K,endWhenDone:!1,fn:async r=>{async function o({currentStep:r,responseMessages:d,usage:b}){var T,x,E,S,k;let N,_,O=H.includeRawChunks;R=new tq;let j=await e0({system:s,prompt:i,messages:l}),A=[...j.messages,...d],D=await (null==y?void 0:y({model:e,steps:$,stepNumber:$.length,messages:A})),q=ek(null!=(T=null==D?void 0:D.model)?T:e),P=await eD({prompt:{system:null!=(x=null==D?void 0:D.system)?x:j.system,messages:null!=(E=null==D?void 0:D.messages)?E:A},supportedUrls:await q.supportedUrls,download:M}),{toolChoice:U,tools:F}=e$({tools:u,toolChoice:null!=(S=null==D?void 0:D.toolChoice)?S:p,activeTools:null!=(k=null==D?void 0:D.activeTools)?k:c}),{result:{stream:J,response:L,request:B},doStreamSpan:V,startTimestampMs:W}=await G(()=>e5({name:"ai.streamText.doStream",attributes:te({telemetry:t,attributes:{...e2({operationId:"ai.streamText.doStream",telemetry:t}),...Z,"ai.model.provider":q.provider,"ai.model.id":q.modelId,"ai.prompt.messages":{input:()=>tt(P)},"ai.prompt.tools":{input:()=>null==F?void 0:F.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=U?JSON.stringify(U):void 0},"gen_ai.system":q.provider,"gen_ai.request.model":q.modelId,"gen_ai.request.frequency_penalty":Y.frequencyPenalty,"gen_ai.request.max_tokens":Y.maxOutputTokens,"gen_ai.request.presence_penalty":Y.presencePenalty,"gen_ai.request.stop_sequences":Y.stopSequences,"gen_ai.request.temperature":Y.temperature,"gen_ai.request.top_k":Y.topK,"gen_ai.request.top_p":Y.topP}}),tracer:K,endWhenDone:!1,fn:async e=>({startTimestampMs:z(),doStreamSpan:e,result:await q.doStream({...Y,tools:F,toolChoice:U,responseFormat:null==f?void 0:f.responseFormat,prompt:P,providerOptions:g,abortSignal:n,headers:a,includeRawChunks:O})})})),Q=function({tools:e,generatorStream:t,tracer:a,telemetry:r,system:o,messages:n,abortSignal:s,repairToolCall:i,experimental_context:l}){let u,p=null,d=new ReadableStream({start(e){p=e}}),c=new Set,m=new Map,h=!1;function f(){h&&0===c.size&&(null!=u&&p.enqueue(u),p.close())}let g=new TransformStream({async transform(t,d){let h=t.type;switch(h){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":d.enqueue(t);break;case"file":d.enqueue({type:"file",file:new tp({data:t.data,mediaType:t.mediaType})});break;case"finish":u={type:"finish",finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata};break;case"tool-call":try{let u=await td({toolCall:t,tools:e,repairToolCall:i,system:o,messages:n});if(d.enqueue(u),u.invalid){p.enqueue({type:"tool-error",toolCallId:u.toolCallId,toolName:u.toolName,input:u.input,error:(0,v.u1)(u.error),dynamic:!0});break}let h=e[u.toolName];if(m.set(u.toolCallId,u.input),null!=h.onInputAvailable&&await h.onInputAvailable({input:u.input,toolCallId:u.toolCallId,messages:n,abortSignal:s,experimental_context:l}),null!=h.execute&&!0!==u.providerExecuted){let e=(0,v.$C)();c.add(e),e5({name:"ai.toolCall",attributes:te({telemetry:r,attributes:{...e2({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":u.toolName,"ai.toolCall.id":u.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(u.input)}}}),tracer:a,fn:async t=>{let a;try{for await(let e of(0,v.o8)({execute:h.execute.bind(h),input:u.input,options:{toolCallId:u.toolCallId,messages:n,abortSignal:s,experimental_context:l}}))p.enqueue({...u,type:"tool-result",output:e.output,..."preliminary"===e.type&&{preliminary:!0}}),"final"===e.type&&(a=e.output)}catch(a){e9(t,a),p.enqueue({...u,type:"tool-error",error:a}),c.delete(e),f();return}c.delete(e),f();try{t.setAttributes(te({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}}})}}catch(e){p.enqueue({type:"error",error:e})}break;case"tool-result":{let e=t.toolName;t.isError?p.enqueue({type:"tool-error",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),providerExecuted:t.providerExecuted,error:t.result}):d.enqueue({type:"tool-result",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),output:t.result,providerExecuted:t.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${h}`)}},flush(){h=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:J,tracer:K,telemetry:t,system:s,messages:A,repairToolCall:m,abortSignal:n,experimental_context:C}),X=null!=B?B:{},ee=[],et=[],ea={},er="unknown",eo={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},en=!0,es={id:w(),timestamp:I(),modelId:e.modelId},ei="";H.addStream(Q.pipeThrough(new TransformStream({async transform(e,t){var a,r,o,s;if("stream-start"===e.type){N=e.warnings;return}if(en){let e=z()-W;en=!1,V.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),V.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"start-step",request:X,warnings:null!=N?N:[]})}let i=e.type;switch(i){case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":t.enqueue(e);break;case"text-delta":e.delta.length>0&&(t.enqueue({type:"text-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),ei+=e.delta);break;case"reasoning-delta":t.enqueue({type:"reasoning-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case"tool-call":t.enqueue(e),ee.push(e);break;case"tool-result":t.enqueue(e),e.preliminary||et.push(e);break;case"tool-error":t.enqueue(e),et.push(e);break;case"response-metadata":es={id:null!=(a=e.id)?a:es.id,timestamp:null!=(r=e.timestamp)?r:es.timestamp,modelId:null!=(o=e.modelId)?o:es.modelId};break;case"finish":{eo=e.usage,er=e.finishReason,_=e.providerMetadata;let t=z()-W;V.addEvent("ai.stream.finish"),V.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(s=eo.outputTokens)?s:0)/t});break}case"tool-input-start":{ea[e.id]=e.toolName;let a=null==u?void 0:u[e.toolName];(null==a?void 0:a.onInputStart)!=null&&await a.onInputStart({toolCallId:e.id,messages:A,abortSignal:n,experimental_context:C}),t.enqueue({...e,dynamic:(null==a?void 0:a.type)==="dynamic"});break}case"tool-input-end":delete ea[e.id],t.enqueue(e);break;case"tool-input-delta":{let a=ea[e.id],r=null==u?void 0:u[a];(null==r?void 0:r.onInputDelta)!=null&&await r.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:A,abortSignal:n,experimental_context:C}),t.enqueue(e);break}case"error":t.enqueue(e),er="error";break;case"raw":O&&t.enqueue(e);break;default:throw Error(`Unknown chunk type: ${i}`)}},async flush(e){let a=ee.length>0?JSON.stringify(ee):void 0;try{V.setAttributes(te({telemetry:t,attributes:{"ai.response.finishReason":er,"ai.response.text":{output:()=>ei},"ai.response.toolCalls":{output:()=>a},"ai.response.id":es.id,"ai.response.model":es.modelId,"ai.response.timestamp":es.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(_),"ai.usage.inputTokens":eo.inputTokens,"ai.usage.outputTokens":eo.outputTokens,"ai.usage.totalTokens":eo.totalTokens,"ai.usage.reasoningTokens":eo.reasoningTokens,"ai.usage.cachedInputTokens":eo.cachedInputTokens,"gen_ai.response.finish_reasons":[er],"gen_ai.response.id":es.id,"gen_ai.response.model":es.modelId,"gen_ai.usage.input_tokens":eo.inputTokens,"gen_ai.usage.output_tokens":eo.outputTokens}}))}catch(e){}finally{V.end()}e.enqueue({type:"finish-step",finishReason:er,usage:eo,providerMetadata:_,response:{...es,headers:null==L?void 0:L.headers}});let n=ta(b,eo);await R.promise;let s=ee.filter(e=>!0!==e.providerExecuted),i=et.filter(e=>!0!==e.providerExecuted);if(s.length>0&&i.length===s.length&&!await tf({stopConditions:h,steps:$})){d.push(...tv({content:$[$.length-1].content,tools:u}));try{await o({currentStep:r+1,responseMessages:d,usage:n})}catch(t){e.enqueue({type:"error",error:t}),H.closeStream()}}else e.enqueue({type:"finish",finishReason:er,totalUsage:n}),H.closeStream()}})))}_=r,await o({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(e=>{H.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),H.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return tO(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.text)}})))}get fullStream(){return tO(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await tj({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(a){null==(t=null==e?void 0:e.onError)||t.call(e,a)}}get experimental_partialOutputStream(){if(null==this.output)throw new C;return tO(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:o=!0,sendSources:n=!1,sendStart:s=!0,sendFinish:i=!0,onError:l=b.u1}={}){let u=null!=t?function({originalMessages:e,responseMessageId:t}){if(null==e)return;let a=e[e.length-1];return(null==a?void 0:a.role)==="assistant"?a.id:"function"==typeof t?t():t}({originalMessages:e,responseMessageId:t}):void 0,p={},d=e=>{var t,a;let r=p[e];return(null==(a=null==(t=this.tools)?void 0:t[r])?void 0:a.type)==="dynamic"||void 0};return tO(function({messageId:e,originalMessages:t=[],onFinish:a,onError:r,stream:o}){let n=null==t?void 0:t[t.length-1];(null==n?void 0:n.role)!=="assistant"?n=void 0:e=n.id;let s=!1,i=o.pipeThrough(new TransformStream({transform(t,a){"start"===t.type&&null==t.messageId&&null!=e&&(t.messageId=e),"abort"===t.type&&(s=!0),a.enqueue(t)}}));if(null==a)return i;let l=function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:n?structuredClone(n):void 0,messageId:null!=e?e:""}),u=!1,p=async()=>{if(u||!a)return;u=!0;let e=l.message.id===(null==n?void 0:n.id);await a({isAborted:s,isContinuation:e,responseMessage:l.message,messages:[...e?t.slice(0,-1):t,l.message]})};return(function({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:o,onToolCall:n,onData:s}){return e.pipeThrough(new TransformStream({async transform(e,i){await r(async({state:r,write:l})=>{var u,p,d,c;function m(e){let t=r.message.parts.filter(tR).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function h(e){let t=r.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function f(e){var t;let a=r.message.parts.find(t=>tR(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function g(e){var t;let a=r.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.toolName=e.toolName,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=null!=(t=e.rawInput)?t:a.rawInput,a.preliminary=e.preliminary,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function y(e){if(null!=e){let a=null!=r.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let o in a)if(Object.prototype.hasOwnProperty.call(a,o)){let n=a[o];if(void 0===n)continue;let s=o in t?t[o]:void 0,i=null!==n&&"object"==typeof n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp),l=null!=s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp);i&&l?r[o]=e(s,n):r[o]=n}return r}(r.message.metadata,e):e;null!=t&&await (0,v.k5)({value:a,schema:t}),r.message.metadata=a}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeTextParts[e.id]=t,r.message.parts.push(t),l();break}case"text-delta":{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,l();break}case"text-end":{let t=r.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,delete r.activeTextParts[e.id],l();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),l();break}case"reasoning-delta":{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,l();break}case"reasoning-end":{let t=r.activeReasoningParts[e.id];t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,t.state="done",delete r.activeReasoningParts[e.id],l();break}case"file":r.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),l();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),l();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),l();break;case"tool-input-start":{let t=r.message.parts.filter(tR);r.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),l();break}case"tool-input-delta":{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:a}=await tN(t.text);t.dynamic?g({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}):f({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}),l();break}case"tool-input-available":e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerMetadata:e.providerMetadata}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l(),n&&!e.providerExecuted&&await n({toolCall:e});break;case"tool-input-error":e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerMetadata:e.providerMetadata}):f({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l();break;case"tool-output-available":if(e.dynamic){let t=h(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=m(e.toolCallId);f({toolCallId:e.toolCallId,toolName:t_(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}l();break;case"tool-output-error":if(e.dynamic){let t=h(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText})}else{let t=m(e.toolCallId);f({toolCallId:e.toolCallId,toolName:t_(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText})}l();break;case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=e.messageId&&(r.message.id=e.messageId),await y(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&l();break;case"finish":case"message-metadata":await y(e.messageMetadata),null!=e.messageMetadata&&l();break;case"error":null==o||o(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:a[e.type])!=null&&await (0,v.k5)({value:e.data,schema:a[e.type]}),e.transient){null==s||s(e);break}let t=null!=e.id?r.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:r.message.parts.push(e),null==s||s(e),l()}}i.enqueue(e)})}}))})({stream:i,runUpdateMessageJob:async e=>{await e({state:l,write:()=>{}})},onError:r}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await p()},async flush(){await p()}}))}({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let a=null==r?void 0:r({part:e}),c=e.type;switch(c){case"text-start":t.enqueue({type:"text-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-delta":t.enqueue({type:"text-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-end":t.enqueue({type:"text-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-start":t.enqueue({type:"reasoning-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-delta":o&&t.enqueue({type:"reasoning-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-end":t.enqueue({type:"reasoning-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"file":t.enqueue({type:"file",mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case"source":n&&"url"===e.sourceType&&t.enqueue({type:"source-url",sourceId:e.id,url:e.url,title:e.title,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}),n&&"document"===e.sourceType&&t.enqueue({type:"source-document",sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"tool-input-start":{p[e.id]=e.toolName;let a=d(e.id);t.enqueue({type:"tool-input-start",toolCallId:e.id,toolName:e.toolName,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=a?{dynamic:a}:{}});break}case"tool-input-delta":t.enqueue({type:"tool-input-delta",toolCallId:e.id,inputTextDelta:e.delta});break;case"tool-call":{p[e.toolCallId]=e.toolName;let a=d(e.toolCallId);e.invalid?t.enqueue({type:"tool-input-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{},errorText:l(e.error)}):t.enqueue({type:"tool-input-available",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{}});break}case"tool-result":{let a=d(e.toolCallId);t.enqueue({type:"tool-output-available",toolCallId:e.toolCallId,output:e.output,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.preliminary?{preliminary:e.preliminary}:{},...null!=a?{dynamic:a}:{}});break}case"tool-error":{let a=d(e.toolCallId);t.enqueue({type:"tool-output-error",toolCallId:e.toolCallId,errorText:l(e.error),...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=a?{dynamic:a}:{}});break}case"error":t.enqueue({type:"error",errorText:l(e.error)});break;case"start-step":t.enqueue({type:"start-step"});break;case"finish-step":t.enqueue({type:"finish-step"});break;case"start":s&&t.enqueue({type:"start",...null!=a?{messageMetadata:a}:{},...null!=u?{messageId:u}:{}});break;case"finish":i&&t.enqueue({type:"finish",...null!=a?{messageMetadata:a}:{}});break;case"abort":t.enqueue(e);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${c}`)}null!=a&&"start"!==c&&"finish"!==c&&t.enqueue({type:"message-metadata",messageMetadata:a})}})),messageId:null!=u?u:null==t?void 0:t(),originalMessages:e,onFinish:a,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:a,onFinish:r,messageMetadata:o,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:l,onError:u,...p}={}){!function({response:e,status:t,statusText:a,headers:r,stream:o,consumeSseStream:n}){let s=o.pipeThrough(new tk);if(n){let[e,t]=s.tee();s=e,n({stream:t})}tE({response:e,status:t,statusText:a,headers:Object.fromEntries(tT(r,tC).entries()),stream:s.pipeThrough(new TextEncoderStream)})}({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:a,onFinish:r,messageMetadata:o,sendReasoning:n,sendSources:s,sendFinish:i,sendStart:l,onError:u}),...p})}pipeTextStreamToResponse(e,t){tS({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:o,sendSources:n,sendFinish:s,sendStart:i,onError:l,...u}={}){return function({status:e,statusText:t,headers:a,stream:r,consumeSseStream:o}){let n=r.pipeThrough(new tk);if(o){let[e,t]=n.tee();n=e,o({stream:t})}return new Response(n.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:tT(a,tC)})}({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:o,sendSources:n,sendFinish:s,sendStart:i,onError:l}),...u})}toTextStreamResponse(e){return tx({textStream:this.textStream,...e})}},tJ={type:"no-schema",jsonSchema:void 0,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async(e,t)=>void 0===e?{success:!1,error:new Y({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new b.b8({functionality:"element streams in no-schema mode"})}},tL=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async t=>safeValidateTypes3({value:t,schema:e}),createElementStream(){throw new UnsupportedFunctionalityError2({functionality:"element streams in object mode"})}}),tB=e=>{let{$schema:t,...a}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:a}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:t,latestObject:a,isFirstDelta:r,isFinalDelta:o}){var n;if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError2({value:t,cause:"value must be an object that contains an array of elements"})};let s=t.elements,i=[];for(let t=0;t<s.length;t++){let a=s[t],r=await safeValidateTypes3({value:a,schema:e});if(t!==s.length-1||o){if(!r.success)return r;i.push(r.value)}}let l=null!=(n=null==a?void 0:a.length)?n:0,u="";return r&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),o&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},async validateFinalResult(t){if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError2({value:t,cause:"value must be an object that contains an array of elements"})};let a=t.elements;for(let t of a){let a=await safeValidateTypes3({value:t,schema:e});if(!a.success)return a}return{success:!0,value:a}},createElementStream(e){let t=0;return tO(e.pipeThrough(new TransformStream({transform(e,a){switch(e.type){case"object":{let r=e.object;for(;t<r.length;t++)a.enqueue(r[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},tV=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},async validateFinalResult(t){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError2({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let a=t.result;return e.includes(a)?{success:!0,value:a}:{success:!1,error:new TypeValidationError2({value:t,cause:"value must be a string in the enum"})}},async validatePartialResult({value:t,textDelta:a}){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError2({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result,o=e.filter(e=>e.startsWith(r));return 0===t.result.length||0===o.length?{success:!1,error:new TypeValidationError2({value:t,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:o.length>1?r:o[0],textDelta:a}}},createElementStream(){throw new UnsupportedFunctionalityError2({functionality:"element streams in enum mode"})}});async function tW(e,t,a){let r=await safeParseJSON3({text:e});if(!r.success)throw new Y({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let o=await t.validateFinalResult(r.value,{text:e,response:a.response,usage:a.usage});if(!o.success)throw new Y({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.value}async function tG(e,t,a,r){try{return await tW(e,t,r)}catch(o){if(null!=a&&Y.isInstance(o)&&(JSONParseError2.isInstance(o.cause)||TypeValidationError3.isInstance(o.cause))){let n=await a({text:e,error:o.cause});if(null===n)throw o;return await tW(n,t,r)}throw o}}function tK(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e&&"object"!=typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!tK(e[a],t[a]))return!1;return!0}let a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(let o of a)if(!r.includes(o)||!tK(e[o],t[o]))return!1;return!0}(0,v.hK)({prefix:"aiobj",size:24}),(0,v.hK)({prefix:"aiobj",size:24}),((e,t)=>{for(var a in t)x(e,a,{get:t[a],enumerable:!0})})({},{object:()=>tZ,text:()=>tY});var tY=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),tZ=({schema:e})=>{let t=(0,v.mD)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await tN(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},a){let r=await (0,v.N8)({text:e});if(!r.success)throw new Y({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let o=await (0,v.ZZ)({value:r.value,schema:t});if(!o.success)throw new Y({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.value}}},tH=({model:e,middleware:t,modelId:a,providerId:r})=>to(t).reverse().reduce((e,t)=>tQ({model:e,middleware:t,modelId:a,providerId:r}),e),tQ=({model:e,middleware:{transformParams:t,wrapGenerate:a,wrapStream:r,overrideProvider:o,overrideModelId:n,overrideSupportedUrls:s},modelId:i,providerId:l})=>{var u,p,d;async function c({params:a,type:r}){return t?await t({params:a,type:r,model:e}):a}return{specificationVersion:"v2",provider:null!=(u=null!=l?l:null==o?void 0:o({model:e}))?u:e.provider,modelId:null!=(p=null!=i?i:null==n?void 0:n({model:e}))?p:e.modelId,supportedUrls:null!=(d=null==s?void 0:s({model:e}))?d:e.supportedUrls,async doGenerate(t){let r=await c({params:t,type:"generate"}),o=async()=>e.doGenerate(r),n=async()=>e.doStream(r);return a?a({doGenerate:o,doStream:n,params:r,model:e}):o()},async doStream(t){let a=await c({params:t,type:"stream"}),o=async()=>e.doGenerate(a),n=async()=>e.doStream(a);return r?r({doGenerate:o,doStream:n,params:a,model:e}):n()}}},tX="AI_NoSuchProviderError",t0=`vercel.ai.error.${tX}`,t1=Symbol.for(t0),t2=class extends b.eM{constructor({modelId:e,modelType:t,providerId:a,availableProviders:r,message:o=`No such provider: ${a} (available providers: ${r.join()})`}){super({errorName:tX,modelId:e,modelType:t,message:o}),this[y]=!0,this.providerId=a,this.availableProviders=r}static isInstance(e){return b.bD.hasMarker(e,t0)}};y=t1;var t8="2025-06-18",t7=[t8,"2025-03-26","2024-11-05"],t3=I.z.looseObject({name:I.z.string(),version:I.z.string()}),t6=I.z.looseObject({_meta:I.z.optional(I.z.object({}).loose())}),t4=I.z.object({method:I.z.string(),params:I.z.optional(t6)}),t5=I.z.looseObject({experimental:I.z.optional(I.z.object({}).loose()),logging:I.z.optional(I.z.object({}).loose()),prompts:I.z.optional(I.z.looseObject({listChanged:I.z.optional(I.z.boolean())})),resources:I.z.optional(I.z.looseObject({subscribe:I.z.optional(I.z.boolean()),listChanged:I.z.optional(I.z.boolean())})),tools:I.z.optional(I.z.looseObject({listChanged:I.z.optional(I.z.boolean())}))}),t9=t6.extend({protocolVersion:I.z.string(),capabilities:t5,serverInfo:t3,instructions:I.z.optional(I.z.string())}),ae=t6.extend({nextCursor:I.z.optional(I.z.string())}),at=I.z.object({name:I.z.string(),description:I.z.optional(I.z.string()),inputSchema:I.z.object({type:I.z.literal("object"),properties:I.z.optional(I.z.object({}).loose())}).loose()}).loose(),aa=ae.extend({tools:I.z.array(at)}),ar=I.z.object({type:I.z.literal("text"),text:I.z.string()}).loose(),ao=I.z.object({type:I.z.literal("image"),data:I.z.base64(),mimeType:I.z.string()}).loose(),an=I.z.object({uri:I.z.string(),mimeType:I.z.optional(I.z.string())}).loose(),as=an.extend({text:I.z.string()}),ai=an.extend({blob:I.z.base64()}),al=I.z.object({type:I.z.literal("resource"),resource:I.z.union([as,ai])}).loose(),au=t6.extend({content:I.z.array(I.z.union([ar,ao,al])),isError:I.z.boolean().default(!1).optional()}).or(t6.extend({toolResult:I.z.unknown()})),ap=I.z.object({jsonrpc:I.z.literal("2.0"),id:I.z.union([I.z.string(),I.z.number().int()])}).merge(t4).strict(),ad=I.z.object({jsonrpc:I.z.literal("2.0"),id:I.z.union([I.z.string(),I.z.number().int()]),result:t6}).strict(),ac=I.z.object({jsonrpc:I.z.literal("2.0"),id:I.z.union([I.z.string(),I.z.number().int()]),error:I.z.object({code:I.z.number().int(),message:I.z.string(),data:I.z.optional(I.z.unknown())})}).strict(),am=I.z.object({jsonrpc:I.z.literal("2.0")}).merge(I.z.object({method:I.z.string(),params:I.z.optional(t6)})).strict(),ah=I.z.union([ap,am,ad,ac]),af=class{constructor({url:e,headers:t}){this.connected=!1,this.url=new URL(e),this.headers=t}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var a,r,o;try{let o=withUserAgentSuffix8({...this.headers,Accept:"text/event-stream"},`ai-sdk/${eR}`,getRuntimeEnvironmentUserAgent2()),n=await fetch(this.url.href,{headers:o,signal:null==(a=this.abortController)?void 0:a.signal});if(!n.ok||!n.body){let e=new J({message:`MCP SSE Transport Error: ${n.status} ${n.statusText}`});return null==(r=this.onerror)||r.call(this,e),t(e)}let s=n.body.pipeThrough(new TextDecoderStream).pipeThrough(new EventSourceParserStream).getReader(),i=async()=>{var a,r,o;try{for(;;){let{done:t,value:o}=await s.read();if(t){if(this.connected)throw this.connected=!1,new J({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:n,data:i}=o;if("endpoint"===n){if(this.endpoint=new URL(i,this.url),this.endpoint.origin!==this.url.origin)throw new J({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if("message"===n)try{let e=ah.parse(JSON.parse(i));null==(a=this.onmessage)||a.call(this,e)}catch(t){let e=new J({message:"MCP SSE Transport Error: Failed to parse message",cause:t});null==(r=this.onerror)||r.call(this,e)}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(o=this.onerror)||o.call(this,e),t(e)}};this.sseConnection={close:()=>s.cancel()},i()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(o=this.onerror)||o.call(this,e),t(e)}})()})}async close(){var e,t,a;this.connected=!1,null==(e=this.sseConnection)||e.close(),null==(t=this.abortController)||t.abort(),null==(a=this.onclose)||a.call(this)}async send(e){var t,a,r;if(!this.endpoint||!this.connected)throw new J({message:"MCP SSE Transport Error: Not connected"});try{let r=withUserAgentSuffix8({...this.headers,"Content-Type":"application/json"},`ai-sdk/${eR}`,getRuntimeEnvironmentUserAgent2()),o={method:"POST",headers:r,body:JSON.stringify(e),signal:null==(t=this.abortController)?void 0:t.signal},n=await fetch(this.endpoint,o);if(!n.ok){let e=await n.text().catch(()=>null),t=new J({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${n.status}): ${e}`});null==(a=this.onerror)||a.call(this,t);return}}catch(e){null==(r=this.onerror)||r.call(this,e);return}}};b.bD;var ag=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:o,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:s}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=o,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=s}async sendMessages({abortSignal:e,...t}){var a,r,o,n,s;let i=await (0,v.hd)(this.body),l=await (0,v.hd)(this.headers),u=await (0,v.hd)(this.credentials),p=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...i,...t.body},headers:{...l,...t.headers},credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),d=null!=(r=null==p?void 0:p.api)?r:this.api,c=(null==p?void 0:p.headers)!==void 0?p.headers:{...l,...t.headers},m=(null==p?void 0:p.body)!==void 0?p.body:{...i,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},h=null!=(o=null==p?void 0:p.credentials)?o:u,f=null!=(n=this.fetch)?n:globalThis.fetch,g=await f(d,{method:"POST",headers:(0,v.WZ)({"Content-Type":"application/json",...c},`ai-sdk/${eR}`,(0,v.G1)()),body:JSON.stringify(m),credentials:h,signal:e});if(!g.ok)throw Error(null!=(s=await g.text())?s:"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");return this.processResponseStream(g.body)}async reconnectToStream(e){var t,a,r,o,n;let s=await (0,v.hd)(this.body),i=await (0,v.hd)(this.headers),l=await (0,v.hd)(this.credentials),u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...s,...e.body},headers:{...i,...e.headers},credentials:l,requestMetadata:e.metadata})),p=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,d=(null==u?void 0:u.headers)!==void 0?u.headers:{...i,...e.headers},c=null!=(r=null==u?void 0:u.credentials)?r:l,m=null!=(o=this.fetch)?o:globalThis.fetch,h=await m(p,{method:"GET",headers:(0,v.WZ)(d,`ai-sdk/${eR}`,(0,v.G1)()),credentials:c});if(204===h.status)return null;if(!h.ok)throw Error(null!=(n=await h.text())?n:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");return this.processResponseStream(h.body)}},ay=(0,v.fE)(()=>(0,v.jN)(I.z.array(I.z.object({id:I.z.string(),role:I.z.enum(["system","user","assistant"]),metadata:I.z.unknown().optional(),parts:I.z.array(I.z.union([I.z.object({type:I.z.literal("text"),text:I.z.string(),state:I.z.enum(["streaming","done"]).optional(),providerMetadata:eF.optional()}),I.z.object({type:I.z.literal("reasoning"),text:I.z.string(),state:I.z.enum(["streaming","done"]).optional(),providerMetadata:eF.optional()}),I.z.object({type:I.z.literal("source-url"),sourceId:I.z.string(),url:I.z.string(),title:I.z.string().optional(),providerMetadata:eF.optional()}),I.z.object({type:I.z.literal("source-document"),sourceId:I.z.string(),mediaType:I.z.string(),title:I.z.string(),filename:I.z.string().optional(),providerMetadata:eF.optional()}),I.z.object({type:I.z.literal("file"),mediaType:I.z.string(),filename:I.z.string().optional(),url:I.z.string(),providerMetadata:eF.optional()}),I.z.object({type:I.z.literal("step-start")}),I.z.object({type:I.z.string().startsWith("data-"),id:I.z.string().optional(),data:I.z.unknown()}),I.z.object({type:I.z.literal("dynamic-tool"),toolName:I.z.string(),toolCallId:I.z.string(),state:I.z.literal("input-streaming"),input:I.z.unknown().optional(),output:I.z.never().optional(),errorText:I.z.never().optional()}),I.z.object({type:I.z.literal("dynamic-tool"),toolName:I.z.string(),toolCallId:I.z.string(),state:I.z.literal("input-available"),input:I.z.unknown(),output:I.z.never().optional(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional()}),I.z.object({type:I.z.literal("dynamic-tool"),toolName:I.z.string(),toolCallId:I.z.string(),state:I.z.literal("output-available"),input:I.z.unknown(),output:I.z.unknown(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional(),preliminary:I.z.boolean().optional()}),I.z.object({type:I.z.literal("dynamic-tool"),toolName:I.z.string(),toolCallId:I.z.string(),state:I.z.literal("output-error"),input:I.z.unknown(),output:I.z.never().optional(),errorText:I.z.string(),callProviderMetadata:eF.optional()}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("input-streaming"),providerExecuted:I.z.boolean().optional(),input:I.z.unknown().optional(),output:I.z.never().optional(),errorText:I.z.never().optional(),approval:I.z.never().optional()}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("input-available"),providerExecuted:I.z.boolean().optional(),input:I.z.unknown(),output:I.z.never().optional(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional(),approval:I.z.never().optional()}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("approval-requested"),input:I.z.unknown(),providerExecuted:I.z.boolean().optional(),output:I.z.never().optional(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional(),approval:I.z.object({id:I.z.string(),approved:I.z.never().optional(),reason:I.z.never().optional()})}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("approval-responded"),input:I.z.unknown(),providerExecuted:I.z.boolean().optional(),output:I.z.never().optional(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional(),approval:I.z.object({id:I.z.string(),approved:I.z.boolean(),reason:I.z.string().optional()})}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("output-available"),providerExecuted:I.z.boolean().optional(),input:I.z.unknown(),output:I.z.unknown(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional(),preliminary:I.z.boolean().optional(),approval:I.z.object({id:I.z.string(),approved:I.z.literal(!0),reason:I.z.string().optional()}).optional()}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("output-error"),providerExecuted:I.z.boolean().optional(),input:I.z.unknown(),output:I.z.never().optional(),errorText:I.z.string(),callProviderMetadata:eF.optional(),approval:I.z.object({id:I.z.string(),approved:I.z.literal(!0),reason:I.z.string().optional()}).optional()}),I.z.object({type:I.z.string().startsWith("tool-"),toolCallId:I.z.string(),state:I.z.literal("output-denied"),providerExecuted:I.z.boolean().optional(),input:I.z.unknown(),output:I.z.never().optional(),errorText:I.z.never().optional(),callProviderMetadata:eF.optional(),approval:I.z.object({id:I.z.string(),approved:I.z.literal(!1),reason:I.z.string().optional()})})]))}))))}}]);